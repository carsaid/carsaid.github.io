(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{353:function(s,t,a){"use strict";a.r(t);var e=a(7),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("div",{staticClass:"cardListContainer"},[t("div",{staticClass:"card-list"},[t("span",{staticClass:"card-item row-2",staticStyle:{"background-color":"#F0DFB1","--randomColor":"#F0DFB1",color:"#1078E6"}},[t("div",[t("p",{staticClass:"name"},[s._v("原创")]),s._v(" "),t("p",{staticClass:"desc"},[s._v("本博客原创文章，转载请注明出处")])])])]),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 原创\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("desc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 本博客原创文章，转载请注明出处\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bgColor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#F0DFB1'")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("textColor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#1078E6'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])]),t("h1",{attrs:{id:"第1章-k8s集群搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第1章-k8s集群搭建"}},[s._v("#")]),s._v(" 第1章-K8s集群搭建")]),s._v(" "),t("h2",{attrs:{id:"环境说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境说明"}},[s._v("#")]),s._v(" 环境说明")]),s._v(" "),t("p",[s._v("本次实验采用 3 台 Centos 7.9 的虚拟机搭建 K8s 集群（"),t("a",{attrs:{href:"https://mirrors.aliyun.com/centos/7.9.2009/isos/x86_64/",target:"_blank",rel:"noopener noreferrer"}},[s._v("点我"),t("OutboundLink")],1),s._v("下载 Centos 虚拟机镜像文件）。")]),s._v(" "),t("ul",[t("li",[s._v("一台虚拟机作为 master 节点（主控节点）。")]),s._v(" "),t("li",[s._v("另外两台虚拟机作为 node 节点（工作节点）。")])]),s._v(" "),t("p",[s._v("请提前创建好这 3 台虚拟机，这里不教授虚拟机的创建方法。")]),s._v(" "),t("p",[s._v("主机参数表（其中的 XXX 是你的虚拟机网段）：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("序号")]),s._v(" "),t("th",[s._v("主机名")]),s._v(" "),t("th",[s._v("IP地址")]),s._v(" "),t("th",[s._v("节点角色")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("1")]),s._v(" "),t("td",[s._v("www.k10.com")]),s._v(" "),t("td",[s._v("192.168.XXX.10")]),s._v(" "),t("td",[s._v("master")])]),s._v(" "),t("tr",[t("td",[s._v("2")]),s._v(" "),t("td",[s._v("www.k11.com")]),s._v(" "),t("td",[s._v("192.168.XXX.11")]),s._v(" "),t("td",[s._v("node1")])]),s._v(" "),t("tr",[t("td",[s._v("3")]),s._v(" "),t("td",[s._v("www.k12.com")]),s._v(" "),t("td",[s._v("192.168.XXX.12")]),s._v(" "),t("td",[s._v("node2")])])])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("ul",[t("li",[s._v("虚拟机的内存建议设置为 4GB/台，内存太低可能会造成卡顿、死机等情况。")]),s._v(" "),t("li",[s._v("如果你的电脑配置实在太低，可以减少一台 node 机器，将剩余两台机器的内存调整为 3~3.5GB 。")])])]),s._v(" "),t("h2",{attrs:{id:"_1-主机参数配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-主机参数配置"}},[s._v("#")]),s._v(" "),t("Badge",{attrs:{type:"error",text:"1"}}),s._v("1. 主机参数配置")],1),s._v(" "),t("h3",{attrs:{id:"_1-1-ip地址配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-ip地址配置"}},[s._v("#")]),s._v(" "),t("Badge",{attrs:{type:"error",text:"1.1"}}),s._v("1.1 IP地址配置")],1),s._v(" "),t("p",[s._v("根据上方的 “主机参数表” 为 3 台虚拟机配置相应的 IP 地址。")]),s._v(" "),t("p",[s._v("1、 使用"),t("code",[s._v("ifconfig")]),s._v("命令查看当前的网卡名称，此处为"),t("code",[s._v("ens33")]),s._v("。")]),s._v(" "),t("p",[s._v("2、 然后使用"),t("code",[s._v("vim")]),s._v("打开相应的网卡配置文件。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/sysconfig/network-scripts/ifcfg-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("网卡名称"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 例如")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/sysconfig/network-scripts/ifcfg-ens33\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/1-ip/01.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("3、打开文件之后，将原来的配置全部删除，输入以下内容对 IP 地址进行配置，然后保存文件并退出。")]),s._v(" "),t("p",[s._v("（默认情况下，虚拟机中的 X.X.X.1 是你的物理机 IP 地址，而 X.X.X.2 是网关地址）")]),s._v(" "),t("div",{staticClass:"language-conf line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("DEVICE=<网卡名称>\nBOOTPROTO=static\nONBOOT=yes\nSTARTMODE=auto\nIPADDR=<IP地址>\nNETMASK=<子网掩码>\nGATEWAY=<网关>\nDNS1=8.8.8.8\n\n# 例如\nDEVICE=ens33\nBOOTPROTO=static\nONBOOT=yes\nSTARTMODE=auto\nIPADDR=192.168.80.10\nNETMASK=255.255.255.0\nGATEWAY=192.168.80.2\nDNS1=8.8.8.8\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/1-ip/02.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("4、保存退出之后，重启网络服务，再次查看主机的 IP 地址信息，修改成功。然后 ping 一下外网，如果能通，说明正常。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("systemctl restart network\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" bing.com\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/1-ip/03.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("5、在物理机上 ping 一下这台虚拟机，如果能通的话就在虚拟机上启用 ssh 服务，然后用自己喜欢的 SSH客户端工具 进行连接，方便后续的配置操作。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("systemctl start sshd\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-tnlp")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("（我使用的 SSH 客户端工具为"),t("a",{attrs:{href:"https://www.vandyke.com/products/securecrt/",target:"_blank",rel:"noopener noreferrer"}},[s._v("SecureCRT"),t("OutboundLink")],1),s._v("，正版需要付费，那个版自己上网找）（你也可以使用免费的"),t("a",{attrs:{href:"https://putty.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("PuTTY"),t("OutboundLink")],1),s._v("或者"),t("a",{attrs:{href:"https://github.com/kingToolbox/WindTerm/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("WindTerm"),t("OutboundLink")],1),s._v("）")]),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/1-ip/04.png",alt:"Not Found Image"}}),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/1-ip/05.png",alt:"Not Found Image"}}),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/1-ip/06.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("6、使用相同的配置方式，为另外 2 台虚拟机配置 IP 地址，然后启用 sshd 服务并远程连接。")]),s._v(" "),t("div",{staticClass:"language-conf line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# node1的配置\nDEVICE=ens33\nBOOTPROTO=static\nONBOOT=yes\nSTARTMODE=auto\nIPADDR=192.168.80.11\nNETMASK=255.255.255.0\nGATEWAY=192.168.80.2\nDNS1=8.8.8.8\n\n# node2的配置\nDEVICE=ens33\nBOOTPROTO=static\nONBOOT=yes\nSTARTMODE=auto\nIPADDR=192.168.80.12\nNETMASK=255.255.255.0\nGATEWAY=192.168.80.2\nDNS1=8.8.8.8\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/1-ip/07.png",alt:"Not Found Image"}}),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/1-ip/08.png",alt:"Not Found Image"}}),s._v(" "),t("h3",{attrs:{id:"_1-2-主机名配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-主机名配置"}},[s._v("#")]),s._v(" "),t("Badge",{attrs:{type:"error",text:"1.2"}}),s._v("1.2 主机名配置")],1),s._v(" "),t("p",[s._v("根据上方的 “主机参数表” 为 3 台虚拟机配置相应的主机名，并在 hosts 文件中同步它们的主机名。")]),s._v(" "),t("p",[s._v("1、使用以下命令，分别为 3 台虚拟机配置主机名。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hostnamectl set-hostname www.k10.com\n\nhostnamectl set-hostname www.k11.com\n\nhostnamectl set-hostname www.k12.com\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/2-hostname/01.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("2、配置"),t("code",[s._v("/etc/hosts")]),s._v("文件，在每台主机之间同步主机名。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在每台主机的终端中运行以下命令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts")]),s._v("\n192.168.80.10 www.k10.com k10\n192.168.80.11 www.k11.com k11\n192.168.80.12 www.k12.com k12\nEOF")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/2-hostname/04.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("3、测试主机名配置是否成功。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 三台主机之间互相ping")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" k10\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" k11\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" k12\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/2-hostname/05.png",alt:"Not Found Image"}}),s._v(" "),t("h3",{attrs:{id:"_1-3-配置防火墙-关闭selinux"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-配置防火墙-关闭selinux"}},[s._v("#")]),s._v(" "),t("Badge",{attrs:{type:"error",text:"1.3"}}),s._v("1.3 配置防火墙 && 关闭selinux")],1),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("为所有主机执行以下操作。")])]),s._v(" "),t("p",[s._v("防火墙 和 selinux 可能会影响 K8s 环境的正常运行，所以要进行配置/禁用。")]),s._v(" "),t("p",[s._v("1、设置防火墙为"),t("b",[s._v("信任模式")]),s._v("，使 主机或容器之间 能够正常通信。")]),s._v(" "),t("p",[s._v("（注意，不是禁用防火墙，禁用以后还是会拦你）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("firewall-cmd --set-default-zone"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("trusted\nfirewall-cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--reload")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/3-firewall/01.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("2、禁用 selinux ，使容器能够正常访问主机文件系统。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时禁用")]),s._v("\nsetenforce "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\ngetenforce\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改配置文件，永久禁用")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/selinux/config\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/3-firewall/02.png",alt:"Not Found Image"}}),s._v(" "),t("h3",{attrs:{id:"_1-4-关闭swap-交换分区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-关闭swap-交换分区"}},[s._v("#")]),s._v(" "),t("Badge",{attrs:{type:"error",text:"1.4"}}),s._v("1.4 关闭swap（交换分区）")],1),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("为所有主机执行以下操作。")])]),s._v(" "),t("p",[s._v("（K8s 和 swap 兼容性好像不是很好，具体可以看看"),t("a",{attrs:{href:"https://github.com/kubernetes/kubernetes/issues/53533",target:"_blank",rel:"noopener noreferrer"}},[s._v("这个"),t("OutboundLink")],1),s._v("）")]),s._v(" "),t("p",[s._v("1、关闭 swap ，然后在"),t("code",[s._v("/etc/fstab")]),s._v("文件中注释掉所有的 swap 条目。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看已经启用的swap状态")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("swapon")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭swap")]),s._v("\nswapoff "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/fstab\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/4-swap/01.png",alt:"Not Found Image"}}),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/4-swap/02.png",alt:"Not Found Image"}}),s._v(" "),t("h3",{attrs:{id:"_1-5-配置-更新yum源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-配置-更新yum源"}},[s._v("#")]),s._v(" "),t("Badge",{attrs:{type:"error",text:"1.5"}}),s._v("1.5 配置 && 更新yum源")],1),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("为所有主机执行以下操作。")])]),s._v(" "),t("p",[s._v("1、此处使用阿里云的"),t("a",{attrs:{href:"https://developer.aliyun.com/mirror/kubernetes",target:"_blank",rel:"noopener noreferrer"}},[s._v("yum源"),t("OutboundLink")],1),s._v("，配置命令如下。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除原有的yum源")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" /etc/yum.repos.d/*\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置yum源（基础软件源）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置yum源（K8s软件源）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/yum.repos.d/kubernetes.repo")]),s._v("\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新yum源，时间可能较长 需要耐心等待")]),s._v("\nyum update "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/5-yum/01.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("2、yum 源更新完成之后，查看是否有 K8s 相关的软件包。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出软件包kubectl")]),s._v("\nyum list kubectl\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出所有版本")]),s._v("\nyum list kubectl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--showduplicates")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/5-yum/02.png",alt:"Not Found Image"}}),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/5-yum/03.png",alt:"Not Found Image"}}),s._v(" "),t("h3",{attrs:{id:"_1-6-设置内核参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-设置内核参数"}},[s._v("#")]),s._v(" "),t("Badge",{attrs:{type:"error",text:"1.6"}}),s._v("1.6 设置内核参数")],1),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("为所有主机执行以下操作。")])]),s._v(" "),t("div",{staticClass:"custom-block note"},[t("p",{staticClass:"custom-block-title"},[s._v("学习更多")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/best_luxi/article/details/121823983",target:"_blank",rel:"noopener noreferrer"}},[s._v("为什么K8s要设置bridge-nf-call-iptables"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("1、使用以下命令，设置系统的内核参数。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置内核的网络参数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/sysctl.d/k8s.conf")]),s._v("\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.ipv4.ip_forward = 1\nEOF")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加载br_netfilter模块")]),s._v("\nmodprobe br_netfilter\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 让新的内核配置立即生效")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /etc/sysctl.d/k8s.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/6-kernel/01.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("2、在某些情况下，执行"),t("code",[s._v("sysctl")]),s._v("的过程中可能会出现错误（如图 “没有那个文件或目录”），可以运行命令"),t("code",[s._v("modprobe br_netfilter")]),s._v("加载缺少的模块，从而解决这个问题。")]),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/6-kernel/02.png",alt:"Not Found Image"}}),s._v(" "),t("h2",{attrs:{id:"_2-k8s环境部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-k8s环境部署"}},[s._v("#")]),s._v(" ## "),t("Badge",{attrs:{type:"error",text:"2"}}),s._v("2. K8s环境部署")],1),s._v(" "),t("h3",{attrs:{id:"_2-1-安装软件包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-安装软件包"}},[s._v("#")]),s._v(" "),t("Badge",{attrs:{type:"error",text:"2.1"}}),s._v("2.1 安装软件包")],1),s._v(" "),t("p",[s._v("K8s 共有 3 个软件包，分别是：")]),s._v(" "),t("ul",[t("li",[s._v("kubeadm：K8s 管理工具，用于部署、升级等操作。")]),s._v(" "),t("li",[s._v("kubectl：K8s 命令行工具，用于管理集群内的节点和容器等资源。")]),s._v(" "),t("li",[s._v("kubelet：K8s 主服务，每台主机上都运行一个名为 kubelet 的服务，用于通信等操作（例如接收主控端的命令并执行相应操作）。")])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("为所有主机执行以下操作。")])]),s._v(" "),t("p",[s._v("1、此处安装 1.26 版本的软件包，在后面的 “升级教程” 中再将其提升至 1.27 版本。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("--disableexcludes")]),s._v("：禁用排除选项，允许 kubernetes 相关软件包进行更新。")]),s._v(" "),t("li",[s._v("（注意，安装时如果没有指定版本，则安装的是最新版本）")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" kubeadm-1.26.5-0 kubectl-1.26.5-0 kubelet-1.26.5-0 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--disableexcludes")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/7-install/01.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("确定安装的软件包没有问题，输入 “y” 并回车，以确认安装。")]),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/7-install/02.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("2、安装完成之后，使用"),t("code",[s._v("systemctl status kubelet")]),s._v("命令查看服务是否存在。")]),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/7-install/03.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("3、运行以下命令，重启 kubelet 服务，并将其设置为开启自启。此时服务的状态为 “activating” ，说明正常。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("systemctl restart kubelet\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kubelet\n\nsystemctl status kubelet\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/7-install/04.png",alt:"Not Found Image"}}),s._v(" "),t("h3",{attrs:{id:"_2-2-安装containerd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-安装containerd"}},[s._v("#")]),s._v(" "),t("Badge",{attrs:{type:"error",text:"2.2"}}),s._v("2.2 安装containerd")],1),s._v(" "),t("p",[s._v("我们使用 "),t("a",{attrs:{href:"https://containerd.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("containerd"),t("OutboundLink")],1),s._v(" 作为 K8s 的容器运行时。至于为什么不用 docker ，请看本篇教程的 “前言” 章节。")]),s._v(" "),t("p",[s._v("（Github访问较慢，也许你需要"),t("a",{attrs:{href:"https://ghproxy.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Github文件下载加速"),t("OutboundLink")],1),s._v("）")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("为所有主机执行以下操作。")])]),s._v(" "),t("p",[s._v("1、运行以下命令，下载并安装 containerd。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载containerd")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/containerd/containerd/releases/download/v1.7.2/containerd-1.7.2-linux-amd64.tar.gz\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" Cxzvf /usr/local containerd-1.7.2-linux-amd64.tar.gz\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /etc/containerd\ncontainerd config default "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/containerd/config.toml\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取service文件，然后 重载服务+重启服务+设置为开机自启")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://raw.githubusercontent.com/containerd/containerd/main/containerd.service "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" /usr/lib/systemd/system/containerd.service\nsystemctl daemon-reload\nsystemctl restart containerd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" containerd\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此时服务状态为 “active (running)”")]),s._v("\nsystemctl status containerd\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("从 Github 下载 containerd 软件包：")]),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/8-containerd/01.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("containerd 服务状态：active（running）")]),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/8-containerd/02.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("2、打开 containerd 配置文件，查看 sandbox_image 配置项，所需镜像名称为"),t("code",[s._v("registry.k8s.io/pause:3.8")]),s._v("。")]),s._v(" "),t("p",[s._v("由于国内网络原因，无法直接访问镜像站点，所以此处需要提前下载镜像，以防后续出现问题。（此处通过国内的阿里云镜像源 来下载所需的镜像）")]),s._v(" "),t("p",[t("code",[s._v("ctr")]),s._v("是 containerd 安装时自带的命令行工具，具有"),t("b",[s._v("命名空间")]),s._v("的概念，和 K8s 有关的镜像都被放在"),t("code",[s._v("k8s.io")]),s._v("这个命名空间里面。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所需镜像名")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/containerd/config.toml\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建命名空间k8s.io")]),s._v("\nctr ns create k8s.io\nctr ns "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取所需镜像，放入命名空间 k8s.io")]),s._v("\nctr "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" k8s.io i pull registry.aliyuncs.com/google_containers/pause:3.8\nctr "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" k8s.io i "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重命名镜像")]),s._v("\nctr "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" k8s.io i tag registry.aliyuncs.com/google_containers/pause:3.8 registry.k8s.io/pause:3.8\nctr "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" k8s.io i "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("创建命名空间：")]),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/8-containerd/03.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("所需的镜像为 pause ，通过阿里云源拉取该镜像：")]),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/8-containerd/04.png",alt:"Not Found Image"}}),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/8-containerd/05.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("更改镜像名称，下方会多出一个条目，说明命名成功。")]),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/8-containerd/06.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("3、为其他主机执行相同的操作，保证每台主机上都安装了 containerd 和 拉取了所需的镜像。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将containerd文件拷贝到另外两台主机上（节省下载时间），然后执行相同的操作")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" containerd-1.7.2-linux-amd64.tar.gz root@192.168.80.11:/root\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" containerd-1.7.2-linux-amd64.tar.gz root@192.168.80.12:/root\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"_2-3-安装runc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-安装runc"}},[s._v("#")]),s._v(" "),t("Badge",{attrs:{type:"error",text:"2.3"}}),s._v("2.3 安装runC")],1),s._v(" "),t("p",[s._v("（containerd 的组件）")]),s._v(" "),t("p",[s._v("（Github访问较慢，也许你需要"),t("a",{attrs:{href:"https://ghproxy.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Github文件下载加速"),t("OutboundLink")],1),s._v("）")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("为所有主机执行以下操作。")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/opencontainers/runc/releases/download/v1.1.7/runc.amd64\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("755")]),s._v(" runc.amd64 /usr/local/sbin/runc\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将文件拷贝到另外两台主机上（节省下载时间），然后执行相同的操作")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" runc.amd64 root@192.168.80.11:/root\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" runc.amd64 root@192.168.80.12:/root\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/9-runc/01.png",alt:"Not Found Image"}}),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/9-runc/02.png",alt:"Not Found Image"}}),s._v(" "),t("h3",{attrs:{id:"_2-4-安装cni-plugins"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-安装cni-plugins"}},[s._v("#")]),s._v(" "),t("Badge",{attrs:{type:"error",text:"2.4"}}),s._v("2.4 安装CNI plugins")],1),s._v(" "),t("p",[s._v("（containerd 的组件）")]),s._v(" "),t("p",[s._v("（Github访问较慢，也许你需要"),t("a",{attrs:{href:"https://ghproxy.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Github文件下载加速"),t("OutboundLink")],1),s._v("）")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("为所有主机执行以下操作。")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/containernetworking/plugins/releases/download/v1.3.0/cni-plugins-linux-amd64-v1.3.0.tgz\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /opt/cni/bin\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.3.0.tgz\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将文件拷贝到另外两台主机上（节省下载时间），然后执行相同的操作")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" cni-plugins-linux-amd64-v1.3.0.tgz root@192.168.80.11:/root\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" cni-plugins-linux-amd64-v1.3.0.tgz root@192.168.80.12:/root\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/10-cni/01.png",alt:"Not Found Image"}}),s._v(" "),t("h3",{attrs:{id:"_2-5-部署集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-部署集群"}},[s._v("#")]),s._v(" "),t("Badge",{attrs:{type:"error",text:"2.5"}}),s._v("2.5 部署集群")],1),s._v(" "),t("p",[s._v("1、初始化 master 节点，执行以下命令：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("--image-repository")]),s._v("：指定镜像源，此处使用国内的阿里云镜像源。")]),s._v(" "),t("li",[t("code",[s._v("--kubernetes-version")]),s._v("：指定集群版本。")]),s._v(" "),t("li",[t("code",[s._v("--pod-network-cidr")]),s._v("：指定 Pod 的网段。")]),s._v(" "),t("li",[t("code",[s._v("--cri-socket")]),s._v("：指定容器运行时。")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubeadm init --image-repository registry.aliyuncs.com/google_containers "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--kubernetes-version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("v1.26.5 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--pod-network-cidr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".0.0/16 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--cri-socket"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("unix:///run/containerd/containerd.sock\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("在 master 主机上，运行以上命令进行集群初始化操作（时间可能较长，需要耐心等待）。")]),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/11-init/01.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("如果初始化成功，则 K8s 会在命令行返回 3 条命令给我们，如图所示：")]),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/11-init/02.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("2、在 master 节点上执行这 3 条命令，进行初始化配置。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" /etc/kubernetes/admin.conf "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/11-init/03.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("3、在另外两个 node 节点上执行以下命令，加入刚刚的集群。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubeadm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".80.10:6443 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--token")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("你的集群Token"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        --discovery-token-ca-cert-hash sha256:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("你的集群证书Hash"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("在上述的 步骤-1 中初始化成功之后，K8s 除了返回 3 条配置命令之外，还会提供加入集群的命令。")]),s._v(" "),t("p",[s._v("在 node 主机上运行这条命令，即可加入集群。")]),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/11-init/04.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("在 node 节点加入集群之前，集群内只有一个 master 节点：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前集群内的所有节点")]),s._v("\nkubectl get nodes\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/11-init/05.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("在另外两个 node 节点上运行加入集群的命令：")]),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/11-init/06.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("加入集群之后，再次进行查看，集群内有 master + node1 + node2 共三个节点：")]),s._v(" "),t("img",{attrs:{src:"https://cdn.staticaly.com/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/knowledge-base/container/kubernetes/k8s-env-build/11-init/07.png",alt:"Not Found Image"}}),s._v(" "),t("p",[s._v("如果你没有保存 “加入集群” 的命令或者丢失了，则可以运行以下命令，获取一个新的 “加入集群” 命令。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建新的 token 并显示加入集群的命令")]),s._v("\nkubeadm token create --print-join-command\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"_3-结语"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-结语"}},[s._v("#")]),s._v(" "),t("Badge",{attrs:{type:"error",text:"3"}}),s._v("3. 结语")],1),s._v(" "),t("p",[s._v("K8s 集群已经搭建成功，但其还不能投入使用，因为集群还需要进行一些额外的配置。")]),s._v(" "),t("p",[s._v("在下一章中，将对已搭建的 K8s 集群进行一些基本的可用性配置。")])])}),[],!1,null,null,null);t.default=n.exports}}]);