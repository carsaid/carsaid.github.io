(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{334:function(s,a,t){"use strict";t.r(a);var e=t(7),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"cardListContainer"},[a("div",{staticClass:"card-list"},[a("span",{staticClass:"card-item row-2",staticStyle:{"background-color":"#F0DFB1","--randomColor":"#F0DFB1",color:"#1078E6"}},[a("div",[a("p",{staticClass:"name"},[s._v("原创")]),s._v(" "),a("p",{staticClass:"desc"},[s._v("本博客原创文章，转载请注明出处")])])])]),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 原创\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("desc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 本博客原创文章，转载请注明出处\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bgColor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#F0DFB1'")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("textColor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#1078E6'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])]),a("h1",{attrs:{id:"第7章-pod与节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第7章-pod与节点"}},[s._v("#")]),s._v(" 第7章-Pod与节点")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("本章要点")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("查看节点的标签 / 注释，为节点设置和删除标签 / 注释")])]),s._v(" "),a("tr",[a("td",[s._v("在指定的节点上创建 Pod")])]),s._v(" "),a("tr",[a("td",[s._v("为节点设置污点，为 Pod 设置容忍污点")])])])]),s._v(" "),a("h2",{attrs:{id:"_1-节点标签-labels"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-节点标签-labels"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"1"}}),s._v("1. 节点标签（Labels）")],1),s._v(" "),a("p",[s._v("默认情况下，创建的 Pod 由 master 自动调度到合适的节点上运行。")]),s._v(" "),a("p",[s._v("但有时候，我们需要在指定的节点上创建和运行 Pod，以满足业务需求。")]),s._v(" "),a("h3",{attrs:{id:"_1-1-查看节点标签"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-查看节点标签"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"1.1"}}),s._v("1.1 查看节点标签")],1),s._v(" "),a("p",[s._v("和 Pod 类似，在设置标签之前，我们可以通过选项"),a("code",[s._v("--show-labels")]),s._v("来查看节点所具有的标签：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get nodes --show-labels\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("默认情况下，每个节点都具有很多的标签，例如标签"),a("code",[s._v("kubernetes.io/os")]),s._v("记录了操作系统类型，标签"),a("code",[s._v("kubernetes.io/hostname")]),s._v("记录了节点的主机名。而 master 节点还拥有几个专属的标签，以此突显出 master 的地位。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-label/01.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("此外，如果你只想查看其中一个或多个节点的信息，则可以这样指定参数：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看单个节点")]),s._v("\nkubectl get nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("节点名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看多个节点")]),s._v("\nkubectl get nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("节点名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("节点名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("节点名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("例如：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get nodes www.k11.com\nkubectl get nodes www.k11.com --show-labels\nkubectl get nodes www.k11.com www.k12.com --show-labels\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-label/02.png",alt:"Not Found Image"}}),s._v(" "),a("h3",{attrs:{id:"_1-2-为节点设置标签"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-为节点设置标签"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"1.2"}}),s._v("1.2 为节点设置标签")],1),s._v(" "),a("p",[s._v("在第 5 章中，我们曾通过"),a("code",[s._v("kubectl label pods")]),s._v("命令为 Pod 设置标签。而对于节点，我们同样可以使用以下命令为其设置标签：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl label nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("节点名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多个标签之间通过 空格 来分隔")]),s._v("\nkubectl label nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("节点名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过 减号- 来删除标签")]),s._v("\nkubectl label nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("节点名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("例如：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为 worker02 节点设置标签")]),s._v("\nkubectl label nodes www.k12.com "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("abc")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("xyz")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("456")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("成功设置标签，多个标签之间通过空格分隔。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-label/03.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("删除标签：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除 worker02 上的 abc 标签")]),s._v("\nkubectl label nodes www.k12.com abc-\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("通过减号"),a("code",[s._v("-")]),s._v("可以很轻松地删除某个标签。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-label/04.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_1-2-1-特殊标签-节点角色"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-特殊标签-节点角色"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"1.2.1"}}),s._v("1.2.1 特殊标签-节点角色")],1),s._v(" "),a("p",[s._v("master 节点上存在这样一个标签"),a("code",[s._v("node-role.kubernetes.io/control-plane=")]),s._v("，这个标签的键名是"),a("code",[s._v("node-role.kubernetes.io/control-plane")]),s._v("，但值却为空？而在键名中，斜杠后面的"),a("code",[s._v("control-plane")]),s._v("又刚好是节点信息 “ROLES” 这一列的内容。")]),s._v(" "),a("p",[s._v("其他工作节点没有这个标签，所以 “ROLES” 这一列的内容为"),a("code",[s._v("<none>")]),s._v("（空）。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-label/05.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("其他工作节点也同样可以设置这个标签，我们分别为其设置一个只有键"),a("code",[s._v("node-role.kubernetes.io/<名称>")]),s._v("，没有值的标签。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为 worker01 和 worker02 节点设置角色标签")]),s._v("\nkubectl label nodes www.k11.com node-role.kubernetes.io/worker1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\nkubectl label nodes www.k12.com node-role.kubernetes.io/worker2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("可以看到，在为节点设置了一个只有键"),a("code",[s._v("node-role.kubernetes.io/<名称>")]),s._v("没有值的标签之后，节点信息 “ROLES” 那一列的内容变为了斜杠"),a("code",[s._v("/")]),s._v("后面的名称。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-label/06.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("能否删除这个标签呢？可以，同样是使用 “键名 + 减号"),a("code",[s._v("-")]),s._v("” 的格式来删除这些标签。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除 master 节点的角色标签")]),s._v("\nkubectl label nodes www.k10.com node-role.kubernetes.io/control-plane-\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("删除标签"),a("code",[s._v("node-role.kubernetes.io/<名称>")]),s._v("之后，节点信息 “ROLES” 这一列的内容也会变为空。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-label/07.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("该标签不需要参数值，所以你留空，或提供一个空字符串都可以。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不加引号")]),s._v("\nkubectl label nodes www.k10.com node-role.kubernetes.io/control-plane"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加引号")]),s._v("\nkubectl label nodes www.k10.com node-role.kubernetes.io/control-plane"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("但就算你真的为该标签提供了一个值，那也不会有任何影响。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-label/08.png",alt:"Not Found Image"}}),s._v(" "),a("h2",{attrs:{id:"_2-手动指定pod运行位置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-手动指定pod运行位置"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"2"}}),s._v("2. 手动指定Pod运行位置")],1),s._v(" "),a("p",[s._v("看了那么久，节点的标签和 Pod 有什么关系？")]),s._v(" "),a("h3",{attrs:{id:"_2-1-选择节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-选择节点"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"2.1"}}),s._v("2.1 选择节点")],1),s._v(" "),a("p",[s._v("下面我们通过"),a("code",[s._v("spec.nodeSelector")]),s._v("字段，让 Pod 在指定的节点上运行。创建以下 yaml 文件：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pod-node.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xyz")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"456"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("看到"),a("code",[s._v('xyz: "456"')]),s._v("你可能会觉得很眼熟，这正是之前为 worker02 节点设置的"),a("code",[s._v("xyz=456")]),s._v("标签。")]),s._v(" "),a("ul",[a("li",[s._v("标签的值一般是不用加引号的，但由于这里的"),a("code",[s._v("456")]),s._v("是纯数字，所以要加上引号，将其视为一个字符串")])]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-selector/01.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("当这个 Pod 被创建时，它会寻找带有"),a("code",[s._v("xyz=456")]),s._v("标签的节点，然后到该节点上运行。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" pod-node.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("从图中可以看到，在创建 Pod 之后，它确实被调度到 worker02 节点上运行了。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-selector/02.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("之前介绍过，标签"),a("code",[s._v("kubernetes.io/hostname")]),s._v("记录了节点的主机名。再创建一个 Pod，这次通过该标签来指定 Pod 的运行位置：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pod-node-2.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kubernetes.io/hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" www.k12.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("创建这个 Pod。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" pod-node-2.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("code",[s._v("pod-node-2")]),s._v("依然运行在 worker02 节点上。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-selector/03.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("之前还介绍过一个特殊的标签-节点角色，这个标签的值一般为空，你可以这样写：")]),s._v(" "),a("ul",[a("li",[s._v("值的位置空着，只写标签的键名")]),s._v(" "),a("li",[s._v("提供一个空字符")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pod-node-3.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node-role.kubernetes.io/worker2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里只设置了键, 值可以空着不写（分号一定要写）")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node-role.kubernetes.io/worker2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里提供了一个空字符串")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("两种写法选一种即可，我这里演示第一种：空值。")]),s._v(" "),a("p",[s._v("创建 Pod 之后，这个 Pod 顺利运行了，并位于 worker02 节点上。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-selector/04.png",alt:"Not Found Image"}}),s._v(" "),a("h3",{attrs:{id:"_2-2-多个标签选择条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-多个标签选择条件"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"2.2"}}),s._v("2.2 多个标签选择条件")],1),s._v(" "),a("p",[s._v("为两个工作节点设置标签，待会要用到。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl label nodes www.k11.com "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("worker "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("opening\nkubectl label nodes www.k12.com "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("worker "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("closed\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-selector/05.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("创建以下 yaml 文件。")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pod-working.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("working\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" worker\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" opening\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("working\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("这个 Pod 将被调度到指定的节点上运行，这个节点必须同时具有"),a("code",[s._v("type=worker")]),s._v("和"),a("code",[s._v("status=opening")]),s._v("两个标签。这些标签是 “且” 的关系，而满足这个条件的只有 worker01 节点。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建这个 Pod")]),s._v("\nkubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" pod-working.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("和预期中想的一样，这个 Pod 被调度到了 worker01 节点上运行。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-selector/06.png",alt:"Not Found Image"}}),s._v(" "),a("h3",{attrs:{id:"_2-3-不满足条件的情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-不满足条件的情况"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"2.3"}}),s._v("2.3 不满足条件的情况")],1),s._v(" "),a("p",[s._v("和上一个 Pod 类似，但这次我将"),a("code",[s._v("status: opening")]),s._v("故意写成了"),a("code",[s._v("status: open")]),s._v("（少了 “ing”）。")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pod-notfound.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("notfound\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" worker\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" open\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("notfound\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("节点必须同时拥有"),a("code",[s._v("type=worker")]),s._v("和"),a("code",[s._v("status=open")]),s._v("两个标签，这个 Pod 才能在其上运行。")]),s._v(" "),a("p",[s._v("但此时没有节点满足这个条件，如果创建这个 Pod 会发生什么？")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" pod-notfound.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可以看到 Pod 的状态一直停留在 “Pending”（等待中）。由于没有合适的节点，所以这个 Pod 会一直处于等待状态，直到出现符合条件的节点。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-selector/07.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("如果后续出现了合适的节点，则 Pod 的状态会转变为 “Running”，否则它将一直等待。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除 worker02 原有的 status 标签")]),s._v("\nkubectl label nodes www.k12.com status-\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为 worker02 设置新的 status 标签")]),s._v("\nkubectl label nodes www.k12.com "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("open\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("标签键名不能重复使用，所以要删除原有标签，才能设置一个新的标签值。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-selector/08.png",alt:"Not Found Image"}}),s._v(" "),a("h3",{attrs:{id:"_2-4-多个满足条件的情况下"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-多个满足条件的情况下"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"2.4"}}),s._v("2.4 多个满足条件的情况下")],1),s._v(" "),a("p",[s._v("如果有多个节点都满足条件，例如 worker01 和 worker02 都拥有标签"),a("code",[s._v("type=worker")]),s._v("，这时候如果我这样写：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" worker\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("两个节点都满足条件，这时候 k8s 就会回到最初的起点......通过算法智能调度 Pod，你可以理解为"),a("b",[s._v("随机")]),s._v("挑选一个节点。")]),s._v(" "),a("p",[s._v("但 k8s 通常会选择"),a("b",[s._v("最空闲")]),s._v("的那个节点，因为要平均每台机器上的 Pod 数量，以实现负载均衡。")]),s._v(" "),a("p",[s._v("所以，只有当集群内拥有大量节点时，"),a("code",[s._v("nodeSelector")]),s._v("才能发挥出最大的效果。")]),s._v(" "),a("h2",{attrs:{id:"_3-节点注释-annotations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-节点注释-annotations"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"3"}}),s._v("3. 节点注释（Annotations）")],1),s._v(" "),a("p",[s._v("注释有点类似于标签，都可以为一个集群资源对象标注信息。")]),s._v(" "),a("h3",{attrs:{id:"_3-1-查看节点注释"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-查看节点注释"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"3.1"}}),s._v("3.1 查看节点注释")],1),s._v(" "),a("p",[s._v("可以通过"),a("code",[s._v("describe")]),s._v("列出节点的详细信息，在详细信息中可以找到节点的注释。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl describe nodes\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只列出一个节点的详细信息")]),s._v("\nkubectl describe nodes www.k10.com\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同时列出多个节点的详细信息，通过 空格 来分隔节点名称")]),s._v("\nkubectl describe nodes www.k11.com www.k12.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("由于节点的详细信息过多，所以此处通过"),a("code",[s._v("head")]),s._v("命令截取前"),a("code",[s._v("20")]),s._v("行的内容。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl describe nodes www.k11.com "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-20")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可以看到，注释记录了 worker01 节点的一些基本信息，例如该节点使用的容器运行时是 containerd，IP 地址是多少等等。")]),s._v(" "),a("p",[s._v("而在注释信息的上方，还列出了节点的所有标签。这些标签一行一个，可读性更高。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/annotations/01.png",alt:"Not Found Image"}}),s._v(" "),a("h3",{attrs:{id:"_3-2-为节点设置注释"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-为节点设置注释"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"3.2"}}),s._v("3.2 为节点设置注释")],1),s._v(" "),a("p",[s._v("使用"),a("code",[s._v("annotate")]),s._v("为集群资源设置注释信息，语法和"),a("code",[s._v("label")]),s._v("是一样的。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl annotate nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("节点名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多个注释信息通过 空格 来分隔")]),s._v("\nkubectl annotate nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("节点名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过 减号- 删除某个注释信息")]),s._v("\nkubectl annotate nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("节点名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("为 worker01 节点设置两个注释信息"),a("code",[s._v("hostname=www.k11.com")]),s._v("和"),a("code",[s._v("node.name=worker01")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl annotate nodes www.k11.com "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("hostname")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("www.k11.com "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("node.name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("worker01\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("注释设置成功。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/annotations/02.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("删除 worker01 的注释信息"),a("code",[s._v("hostname")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl annotate nodes www.k11.com hostname-\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("删除成功，已经看不到刚刚的那条注释了。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/annotations/03.png",alt:"Not Found Image"}}),s._v(" "),a("h3",{attrs:{id:"_3-3-标签和注释的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-标签和注释的区别"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"3.3"}}),s._v("3.3 标签和注释的区别")],1),s._v(" "),a("h4",{attrs:{id:"_1-标签"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-标签"}},[s._v("#")]),s._v(" （1）标签")]),s._v(" "),a("p",[s._v("标签可以用于标记某个集群资源，例如：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为一个 Pod 设置标签")]),s._v("\nkubectl label pods "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Pod名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为一个节点设置标签")]),s._v("\nkubectl label nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("节点名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("然后，你可以通过"),a("code",[s._v("get")]),s._v("或"),a("code",[s._v("describe")]),s._v("查看这些标签：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get pods --show-labels\nkubectl get nodes --show-labels\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("又或者，你可以针对这些标签，进行某些操作，例如：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出具有标签 type=worker 的多个节点")]),s._v("\nkubectl get nodes "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("worker\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同时删除具有标签 abc=123 的多个 Pod")]),s._v("\nkubectl delete pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("abc")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("甚至，你可以通过"),a("code",[s._v("spec.nodeSelector")]),s._v("字段来指定 Pod 的运行位置。")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" opening\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("总的来讲，你可以设置标签、查看标签、针对标签做一些操作。")]),s._v(" "),a("h4",{attrs:{id:"_2-注释"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-注释"}},[s._v("#")]),s._v(" （2）注释")]),s._v(" "),a("p",[s._v("你可以对一个集群资源设置注释、查看其注释，例如：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为一个 Pod 设置注释")]),s._v("\nkubectl annotate pods "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Pod名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 Pod 详细信息并在其中寻找注释")]),s._v("\nkubectl describe pods "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Pod名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("但注释也就仅限于查看了，你"),a("b",[s._v("无法针对注释做一些特殊的操作")]),s._v("。")]),s._v(" "),a("p",[s._v("我们来看看"),a("a",{attrs:{href:"https://baike.baidu.com/item/%E6%B3%A8%E9%87%8A/20146702",target:"_blank",rel:"noopener noreferrer"}},[s._v("编程语言中的注释"),a("OutboundLink")],1),s._v("：")]),s._v(" "),a("ul",[a("li",[s._v("注释就是对代码的解释和说明，其目的是让人们能够更加轻松地了解代码。")]),s._v(" "),a("li",[s._v("注释是编写程序时，写程序的人给一个语句、程序段、函数等的解释或提示，能提高程序代码的可读性。")]),s._v(" "),a("li",[s._v("注释只是为了提高可读性，不会被计算机编译。")])]),s._v(" "),a("p",[s._v("k8s 中的注释和编程语言一样，只是用来看的，不会影响集群的运行。")]),s._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[s._v("笔记")]),s._v(" "),a("p",[a("b",[s._v("k8s 中的注释")]),s._v("：")]),s._v(" "),a("ul",[a("li",[s._v("注释就是对"),a("b",[s._v("集群资源")]),s._v("的解释和说明，其目的是让人们能够更加轻松地了解"),a("b",[s._v("资源信息")]),s._v("。")]),s._v(" "),a("li",[s._v("注释是"),a("b",[s._v("创建集群资源")]),s._v("时，创建者给一个"),a("b",[s._v("资源对象的名称、环境、作用、使用方法")]),s._v("等的解释或提示，能提高"),a("b",[s._v("集群")]),s._v("的可读性、"),a("b",[s._v("可维护性")]),s._v("。")]),s._v(" "),a("li",[s._v("注释只是为了提高可读性，不会被"),a("b",[s._v("集群")]),s._v("作用于任何方面。")])])]),s._v(" "),a("h2",{attrs:{id:"_4-污点与容忍污点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-污点与容忍污点"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"4"}}),s._v("4. 污点与容忍污点")],1),s._v(" "),a("p",[s._v("举个例子，如果一栋房子存在污点（比如是个凶宅），一般买房的人都不会选择这栋房子。但是如果某个人可以容忍这个污点（接受凶宅），那他就可以买下这栋房子并且住进去。")]),s._v(" "),a("p",[s._v("在 k8s 中，如果一个节点存在污点，那么 Pod 就不会被调度到上面运行。但如果这个 Pod 可以容忍污点，那么它就可以在这个节点上运行。")]),s._v(" "),a("p",[a("del",[s._v("什么？你说把污点藏起来，然后骗 Pod 进来？...... k8s 没那种东西。")])]),s._v(" "),a("h3",{attrs:{id:"_4-1-污点-taint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-污点-taint"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"4.1"}}),s._v("4.1 污点（taint）")],1),s._v(" "),a("h4",{attrs:{id:"_4-1-1-查看污点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-1-查看污点"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"4.1.1"}}),s._v("4.1.1 查看污点")],1),s._v(" "),a("p",[s._v("和注释的查看方式一样，都需要通过"),a("code",[s._v("describe")]),s._v("列出节点详情，然后在其中寻找污点信息。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出污点")]),s._v("\nkubectl describe nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" Taint\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出节点角色 和 污点")]),s._v("\nkubectl describe nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-E")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'(Roles|Taints)'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("可以看到，master 节点拥有一个默认的污点"),a("code",[s._v("node-role.kubernetes.io/control-plane:NoSchedule")]),s._v("，而其他两个工作节点的污点默认为"),a("code",[s._v("<none>")]),s._v("（空，没有污点）。")]),s._v(" "),a("p",[s._v("由于 master 是控制节点，所以不应该在其上运行业务 Pod。通过为 master 设置污点，Pod 将会避开它，然后被调度到其他合适的工作节点上运行。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-taint/01.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_4-1-2-为节点设置污点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-2-为节点设置污点"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"4.1.2"}}),s._v("4.1.2 为节点设置污点")],1),s._v(" "),a("p",[s._v("和标签 / 注释一样，污点也采用 “键值对” 的形式，但是污点的键值对具有一个额外属性。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl taint nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("节点名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("效果"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同时设置多个污点，通过 空格 来分隔")]),s._v("\nkubectl taint nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("节点名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("效果"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("效果"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("在这条命令当中，你肯定注意到了 “效果” 这个东西，效果不能随意指定，它有三个可选的值：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("NoSchedule")]),s._v("：后续新创建的 Pod 不会被调度到这个节点，该节点上现有的 Pod 继续运行。")]),s._v(" "),a("li",[a("code",[s._v("NoExecute")]),s._v("：和 NoSchedule 类似，但是会影响节点上现有的 Pod。如果这些 Pod 可以容忍污点，则可以继续运行；如果这些 Pod 不能容忍污点，则会被驱逐到其他节点上运行。")]),s._v(" "),a("li",[a("code",[s._v("PreferNoSchedule")]),s._v("：是 NoSchedule 的降级版本，控制平面在调度 Pod 的时候，会"),a("b",[s._v("尽量")]),s._v("避开这个节点，尽量不让 Pod 在该节点上运行。")])]),s._v(" "),a("p",[s._v("在这三个可选值当中，最经常使用的是"),a("code",[s._v("NoSchedule")]),s._v("，因为你给一个节点设置污点，当然是不希望后续创建的 Pod 在其上运行啦。")]),s._v(" "),a("p",[s._v("运行以下命令，为 worker02 节点设置污点"),a("code",[s._v("personality=bad")]),s._v("，效果是"),a("code",[s._v("NoSchedule")]),s._v("（不允许调度）。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl taint nodes www.k12.com "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("personality")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bad:NoSchedule\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("污点设置成功。")]),s._v(" "),a("p",[s._v("在和 master 的污点进行比较时，你会发现 master 的污点格式是"),a("code",[s._v("<键>:<效果>")]),s._v("，和默认的角色标签一样，都是没有参数值的。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-taint/02.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("创建三个 Pod 测试下污点的效果：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl run pod1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" nginx --image-pull-policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("IfNotPresent\nkubectl run pod2 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" nginx --image-pull-policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("IfNotPresent\nkubectl run pod3 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" nginx --image-pull-policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("IfNotPresent\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("一般来讲，master 会平均地调度 Pod 到每个节点上。")]),s._v(" "),a("p",[s._v("但此时 worker02 拥有污点，所以创建的 Pod 全部跑到 worker01 上面去了。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-taint/03.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_4-1-3-删除污点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-3-删除污点"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"4.1.3"}}),s._v("4.1.3 删除污点")],1),s._v(" "),a("p",[s._v("和标签 / 注释一样，可以通过减号"),a("code",[s._v("-")]),s._v("来删除污点。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl taint nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("节点名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("删除刚刚为 worker02 设置的污点。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl taint nodes www.k12.com personality-\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("删除成功。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-taint/04.png",alt:"Not Found Image"}}),s._v(" "),a("h3",{attrs:{id:"_4-2-为pod设置容忍污点-tolerations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-为pod设置容忍污点-tolerations"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"4.2"}}),s._v("4.2 为Pod设置容忍污点（tolerations）")],1),s._v(" "),a("h4",{attrs:{id:"示例-1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-1"}},[s._v("#")]),s._v(" 示例-1")]),s._v(" "),a("p",[s._v("再为 worker02 设置一个污点，但这次我们不设置 “值”，只有键和效果：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl taint nodes www.k12.com notgood:NoSchedule\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("设置成功。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-taint/05.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("创建以下 yaml 文件：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pod-toler.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("toler\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kubernetes.io/hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" www.k12.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("toler\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("以上 Pod 通过"),a("code",[s._v("nodeSelector")]),s._v("字段指定运行节点为 www.k12.com。但此时该节点具有污点，当创建 Pod 之后，这个 Pod 能否正常运行？")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" pod-toler.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可想而知，虽然标签匹配，但是这个 Pod 无法容忍污点，状态会一直停留在 “Pending”（等待），直到出现一个合适的节点。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-taint/06.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("接下来，修改刚刚的 yaml 文件，在其中添加"),a("code",[s._v("spec.tolerations")]),s._v("字段：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pod-toler.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("toler\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kubernetes.io/hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" www.k12.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tolerations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" notgood\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("effect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NoSchedule\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Exists\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("toler\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("在字段"),a("code",[s._v("spec.tolerations")]),s._v("中：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("key")]),s._v("是要容忍污点的对应 “键”")]),s._v(" "),a("li",[a("code",[s._v("effect")]),s._v("是这个 “键” 的对应 “效果”")]),s._v(" "),a("li",[s._v("这里"),a("code",[s._v("operator")]),s._v("被设置为"),a("code",[s._v("Exists")]),s._v("，意思是可以匹配任何 “值”，包括空值")])]),s._v(" "),a("p",[s._v("修改文件之后，原先创建的 Pod 不用删除，可以使用"),a("code",[s._v("apply")]),s._v("重新应用文件，更新 Pod 属性和状态：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" pod-toler.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("在重新应用文件之后，Pod 的属性得到了更新。现在它可以容忍污点，于是成功地在 worker02 节点上运行了。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-taint/07.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("删除这个 Pod：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl delete "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" pod-toler.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("即使一个 Pod 可以容忍污点，但其不一定会在污点主机上运行，因为运行位置是由 master 随机调度的。")]),s._v(" "),a("p",[s._v("如果你想让 Pod 百分之百运行在污点主机上，那么除了配置容忍污点之外，还需要通过"),a("code",[s._v("nodeSelector")]),s._v("指定其运行位置。")])]),s._v(" "),a("h4",{attrs:{id:"示例-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-2"}},[s._v("#")]),s._v(" 示例-2")]),s._v(" "),a("p",[s._v("一个节点可以同时拥有多个污点。如果 Pod 想要在该节点上运行，就必须容忍其"),a("b",[s._v("所有")]),s._v("污点。")]),s._v(" "),a("p",[s._v("为 worker02 设置第二个污点，这次具有参数值：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl taint nodes www.k12.com "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("personality")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bad:NoSchedule\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("设置成功，此时 worker02 同时具有两个污点。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-taint/08.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("创建以下 yaml 文件：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pod-bad.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("bad\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kubernetes.io/hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" www.k12.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tolerations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"notgood"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("effect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NoSchedule"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Exists"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"personality"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("effect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NoSchedule"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Equal"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bad"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("bad\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("之前你可能就已经注意到了，"),a("code",[s._v("spec.tolerations")]),s._v("是一个数组，意味着它可以同时容忍多个污点。")]),s._v(" "),a("ul",[a("li",[s._v("第一个容忍的污点是"),a("code",[s._v("notgood:NoSchedule")]),s._v("，这和上一个示例相同，不在多讲。")]),s._v(" "),a("li",[s._v("第二个容忍的污点是"),a("code",[s._v("personality=bad:NoSchedule")]),s._v("。在这里"),a("code",[s._v("operator")]),s._v("被设置为了"),a("code",[s._v("Equal")]),s._v("，意思是存在参数值，并且"),a("code",[s._v("value")]),s._v("字段需要和污点中的值相等。")])]),s._v(" "),a("p",[s._v("另外，这一次"),a("code",[s._v("tolerations")]),s._v("中的值都使用引号"),a("code",[s._v('"')]),s._v("包裹起来了，表示这是一个字符串，官方文档中推荐这样做。")]),s._v(" "),a("p",[s._v("创建这个 Pod：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" pod-bad.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("Pod 成功容忍了两个污点，并运行在了 worker02 节点上。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod-and-node/node-taint/09.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"operator与空value"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#operator与空value"}},[s._v("#")]),s._v(" operator与空value")]),s._v(" "),a("p",[s._v("字段"),a("code",[s._v("spec.tolerations.operator")]),s._v("有两个可选的值：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("operator: Exists")]),s._v("：没有"),a("code",[s._v("value")]),s._v("的情况下使用，可以匹配任何值，包括空值")]),s._v(" "),a("li",[a("code",[s._v("operator: Equal")]),s._v("：有"),a("code",[s._v("value")]),s._v("的情况下使用，其值必须和污点中的值相同")])]),s._v(" "),a("p",[s._v("在上面的示例中，这两个"),a("code",[s._v("operator")]),s._v("可选值我们都演示过。例如：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 没有value的情况下")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tolerations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"abc"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("effect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <对应效果"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Exists"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("还有：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 有value的情况下")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tolerations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xyz"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("effect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <对应效果"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Equal"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("456")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("那如果，我即没有污点值（为空），又想将"),a("code",[s._v("operator")]),s._v("设置为"),a("code",[s._v("Equal")]),s._v("怎么办（叛逆）？很简单，只需要提供一个空字符串即可：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Equal 并且无 value 的情况下")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tolerations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jkl"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("effect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <对应效果"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Equal"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("有关于污点的更多信息，你可以查阅官方文档。")]),s._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[s._v("学习更多")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/scheduling-eviction/taint-and-toleration/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Kubernetes 文档-污点和容忍度"),a("OutboundLink")],1)])]),s._v(" "),a("p",[s._v("最后，记得删除 worker02 节点上的所有污点，以免影响后续实验。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl taint "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" www.k12.com notgood-\nkubectl taint "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" www.k12.com personality-\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_5-小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-小结"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"5"}}),s._v("5. 小结")],1),s._v(" "),a("p",[s._v("本章学习了标签和注释的使用方法，并对它们做了一个区分。然后在 yaml 文件中为 Pod 指定了节点标签，以将 Pod 调度到特定的节点上运行。最后介绍了节点的污点，以及 Pod 的容忍污点。")]),s._v(" "),a("p",[s._v("通过本章的学习，并结合前面所学的内容，你应该掌握以下技能：")]),s._v(" "),a("ul",[a("li",[s._v("为节点或 Pod 设置、删除标签")]),s._v(" "),a("li",[s._v("为节点或 Pod 设置、删除注释")]),s._v(" "),a("li",[s._v("针对特定标签，进行批量的资源操作")]),s._v(" "),a("li",[s._v("调度 Pod 到指定的节点上运行")]),s._v(" "),a("li",[s._v("为节点设置、删除污点")]),s._v(" "),a("li",[s._v("使 Pod 容忍污点")])]),s._v(" "),a("p",[s._v("如果你的状态不错，可以去练练手（"),a("RouterLink",{attrs:{to:"/cloud-native-security/kubernetes/practice/05/"}},[s._v("练习题-5")]),s._v("）。")],1)])}),[],!1,null,null,null);a.default=n.exports}}]);