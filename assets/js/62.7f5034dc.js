(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{376:function(t,s,a){"use strict";a.r(s);var e=a(7),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"腾讯云-cos-对象遍历"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#腾讯云-cos-对象遍历"}},[t._v("#")]),t._v(" 腾讯云 COS 对象遍历")]),t._v(" "),s("h2",{attrs:{id:"_1-环境搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-环境搭建"}},[t._v("#")]),t._v(" 1. 环境搭建")]),t._v(" "),s("p",[t._v("使用 "),s("a",{attrs:{href:"https://github.com/HXSecurity/TerraformGoat",target:"_blank",rel:"noopener noreferrer"}},[t._v("TerraformGoat"),s("OutboundLink")],1),t._v(" 搭建漏洞环境。")]),t._v(" "),s("p",[s("b",[t._v("第一步，通过 docker 来运行工具 TerraformGoat ：")])]),t._v(" "),s("ul",[s("li",[t._v("获取 TerraformGoat 镜像；")]),t._v(" "),s("li",[t._v("运行 TerraformGoat 容器；")]),t._v(" "),s("li",[t._v("进入 TerraformGoat 容器。")])]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull registry.cn-hongkong.aliyuncs.com/huoxian_pub/terraformgoat_tencentcloud:0.0.7\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-itd")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" terraformgoat_tencentcloud_0.0.7 registry.cn-hongkong.aliyuncs.com/huoxian_pub/terraformgoat_tencentcloud:0.0.7\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" terraformgoat_tencentcloud_0.0.7 /bin/bash\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/vuln-db/cloud/tencentcloud/cos-traversal/01.png"}}),t._v(" "),s("p",[s("b",[t._v("第二步，为相应的环境 配置腾讯云访问密钥：")])]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /TerraformGoat/tencentcloud/cos/bucket_object_traversal/\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" terraform.tfvars\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("填写你自己的腾讯云 AK 与 KEY ：")]),t._v(" "),s("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/vuln-db/cloud/tencentcloud/cos-traversal/02.png"}}),t._v(" "),s("p",[s("b",[t._v("第三步，初始化 并 部署环境：")])]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("terraform init\nterraform apply\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("部署完成之后，将会返回存储桶的域名：")]),t._v(" "),s("ul",[s("li",[t._v("初始化（时间可能较长，需耐心等待）。")]),t._v(" "),s("li",[t._v("部署环境，需要输入 yes 确认操作。")])]),t._v(" "),s("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/vuln-db/cloud/tencentcloud/cos-traversal/03.png"}}),t._v(" "),s("p",[t._v("存储桶页面：")]),t._v(" "),s("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/vuln-db/cloud/tencentcloud/cos-traversal/04.png"}}),t._v(" "),s("h2",{attrs:{id:"_2-漏洞复现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-漏洞复现"}},[t._v("#")]),t._v(" 2. 漏洞复现")]),t._v(" "),s("p",[t._v("如图，存储桶以 XML 列表的形式，列出了其内的所有文件，说明存在"),s("b",[t._v("存储桶遍历漏洞")]),t._v("。")]),t._v(" "),s("p",[t._v("其中有一个名为"),s("code",[t._v("weflag.txt")]),t._v("的文件。")]),t._v(" "),s("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/vuln-db/cloud/tencentcloud/cos-traversal/05.png"}}),t._v(" "),s("p",[t._v("访问该文件，获得 flag（没错，就是这么简单）。")]),t._v(" "),s("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/vuln-db/cloud/tencentcloud/cos-traversal/06.png"}}),t._v(" "),s("h2",{attrs:{id:"_3-漏洞修复"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-漏洞修复"}},[t._v("#")]),t._v(" 3. 漏洞修复")]),t._v(" "),s("p",[t._v("打开腾讯云控制台，找到"),s("code",[t._v("对象存储 --\x3e 存储桶列表 --\x3e 配置管理")]),t._v("。")]),t._v(" "),s("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/vuln-db/cloud/tencentcloud/cos-traversal/07.png"}}),t._v(" "),s("p",[t._v("进入配置管理之后，找到"),s("code",[t._v("权限管理 --\x3e Policy权限设置 --\x3e 编辑")]),t._v("。")]),t._v(" "),s("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/vuln-db/cloud/tencentcloud/cos-traversal/08.png"}}),t._v(" "),s("p",[t._v("在配置策略中，可以看到一个名为"),s("code",[t._v("GetBucket")]),t._v("的策略项，它将导致"),s("b",[t._v("存储桶遍历漏洞")]),t._v("。")]),t._v(" "),s("p",[s("code",[t._v("删除GetBucket配置项 --\x3e 完成")])]),t._v(" "),s("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/vuln-db/cloud/tencentcloud/cos-traversal/09.png"}}),t._v(" "),s("p",[t._v("有许多配置项 都会导致"),s("b",[t._v("存储桶遍历漏洞")]),t._v("：")]),t._v(" "),s("ul",[s("li",[t._v("读操作（含列出对象列表）")]),t._v(" "),s("li",[t._v("GetBucket")]),t._v(" "),s("li",[t._v("...等危险配置项")])]),t._v(" "),s("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/vuln-db/cloud/tencentcloud/cos-traversal/10.png"}}),t._v(" "),s("p",[t._v("删除对应配置项，保存配置。")]),t._v(" "),s("p",[t._v("刷新存储桶页面，显示 AccessDenied ，修复成功。")]),t._v(" "),s("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/vuln-db/cloud/tencentcloud/cos-traversal/11.png"}}),t._v(" "),s("p",[t._v("虽然 存储桶遍历 不存在了，但是攻击者依然可以通过"),s("b",[t._v("目录/文件枚举")]),t._v("的方式，找到存储桶内的敏感文件。")]),t._v(" "),s("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/vuln-db/cloud/tencentcloud/cos-traversal/12.png"}}),t._v(" "),s("h2",{attrs:{id:"_4-销毁环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-销毁环境"}},[t._v("#")]),t._v(" 4. 销毁环境")]),t._v(" "),s("p",[t._v("练习完成之后，请立马销毁环境，防止：")]),t._v(" "),s("ul",[s("li",[t._v("环境一直运行，持续扣费；")]),t._v(" "),s("li",[t._v("环境是公网访问的，容易遭受攻击；")]),t._v(" "),s("li",[t._v("...等问题")])]),t._v(" "),s("h3",{attrs:{id:"_1-销毁方式一"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-销毁方式一"}},[t._v("#")]),t._v(" （1）销毁方式一")]),t._v(" "),s("p",[t._v("通过命令行进行销毁操作，")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("terraform destroy\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/vuln-db/cloud/tencentcloud/cos-traversal/13.png"}}),t._v(" "),s("h3",{attrs:{id:"_2-销毁方式二"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-销毁方式二"}},[t._v("#")]),t._v(" （2）销毁方式二")]),t._v(" "),s("p",[t._v("通过控制台进行销毁：")]),t._v(" "),s("p",[s("code",[t._v("对象存储 --\x3e 存储桶列表 --\x3e 更多 --\x3e 删除")])]),t._v(" "),s("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/vuln-db/cloud/tencentcloud/cos-traversal/14.png"}}),t._v(" "),s("p",[t._v("再次访问存储桶页面，将会提示 "),s("b",[t._v("NoSuchBucket（没有找到存储桶）")]),t._v("，说明销毁成功。")]),t._v(" "),s("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/vuln-db/cloud/tencentcloud/cos-traversal/15.png"}})])}),[],!1,null,null,null);s.default=r.exports}}]);