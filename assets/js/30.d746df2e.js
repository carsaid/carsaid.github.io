(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{344:function(s,a,t){"use strict";t.r(a);var e=t(7),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"课后练习题-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#课后练习题-5"}},[s._v("#")]),s._v(" 课后练习题-5")]),s._v(" "),a("h2",{attrs:{id:"理论练习-开放性试题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#理论练习-开放性试题"}},[s._v("#")]),s._v(" 理论练习（开放性试题）")]),s._v(" "),a("p",[s._v("涵盖第 7 章的内容。")]),s._v(" "),a("ol",[a("li",[s._v("通过"),a("code",[s._v("kubectl get nodes")]),s._v("查看节点信息时，列 “ROLES” 的内容是空的，如何设置？")]),s._v(" "),a("li",[s._v("一个 Pod 通过"),a("code",[s._v("spec.nodeSelector")]),s._v("字段指定了运行位置，但是没有节点满足条件，那么这个 Pod 的创建是否能成功？")]),s._v(" "),a("li",[s._v("一个 Pod 通过"),a("code",[s._v("spec.nodeSelector")]),s._v("字段指定了运行位置，但此时有多个节点满足条件，那么这个 Pod 会被调度到哪个节点上运行呢？")]),s._v(" "),a("li",[s._v("集群资源的标签和注释有什么区别？")]),s._v(" "),a("li",[s._v("污点和容忍污点是什么？")])]),s._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[s._v("答案")]),s._v(" "),a("ol",[a("li",[s._v("为相应的节点添加一个特殊的角色标签"),a("code",[s._v("node-role.kubernetes.io/<名称>")]),s._v("，只需要键名，不需要值。例如："),a("code",[s._v("kubectl label nodes www.k11.com node-role.kubernetes.io/worker1=")])]),s._v(" "),a("li",[s._v("不会，这个 Pod 的状态会一直停留在 “Pending”（等待），直到出现一个符合条件的节点，或直到用户主动删除它")]),s._v(" "),a("li",[s._v("由控制平面 在满足条件的节点中 自动选择一个最合适的（随机）")]),s._v(" "),a("li",[s._v("标签可以参与到资源对象的操作中，例如 “列出具有特定标签的所有 Pod”。而注释只是为了提高可读性，不会参与到资源对象的运行中")]),s._v(" "),a("li",[s._v("一栋房子有污点（凶宅），一般人绕道走，但如果有人可以容忍污点（不怕凶宅），则可以买房住。一个节点有污点，一般的 Pod 绕道走，但如果有 Pod 可以容忍污点，则可以在这个节点上面运行")])])]),s._v(" "),a("h2",{attrs:{id:"实操练习"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实操练习"}},[s._v("#")]),s._v(" 实操练习")]),s._v(" "),a("p",[s._v("涵盖第 5/6/7 章的内容。")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[s._v("在开始实操练习之前，请先将工作节点（worker）上的污点删除，这些污点可能是你在第 7 章的学习过程中设置的。")])]),s._v(" "),a("ol",[a("li",[s._v("为 worker01 和 worker02 节点都设置"),a("b",[s._v("标签")]),a("code",[s._v("look=good")]),s._v("。")]),s._v(" "),a("li",[s._v("为 worker01 节点设置"),a("b",[s._v("标签")]),a("code",[s._v("inside=bad")]),s._v("，为 worker02 节点设置"),a("b",[s._v("标签")]),a("code",[s._v("inside=good")]),s._v("。")]),s._v(" "),a("li",[s._v("列出具有"),a("b",[s._v("标签")]),a("code",[s._v("look=good")]),s._v("的节点。")]),s._v(" "),a("li",[s._v("为 worker02 添加"),a("b",[s._v("注释")]),s._v("信息"),a("code",[s._v("this-is=Good")]),s._v("，然后列出其"),a("b",[s._v("注释")]),s._v("信息。")]),s._v(" "),a("li",[s._v("创建一个 Pod，要求如下：\n"),a("ul",[a("li",[s._v("名称为"),a("code",[s._v("pod-good")])]),s._v(" "),a("li",[s._v("镜像为"),a("code",[s._v("nginx")]),s._v("，镜像下载策略为"),a("code",[s._v("IfNotPresent")])]),s._v(" "),a("li",[s._v("该 Pod 必须运行在 worker02 节点上")]),s._v(" "),a("li",[s._v("实施资源限制策略，限制 CPU 资源使用上限为"),a("code",[s._v("0.4")]),s._v("个核心，限制内存资源使用上限为"),a("code",[s._v("512")]),s._v(" MiB")])])]),s._v(" "),a("li",[s._v("为 worker01 节点设置"),a("b",[s._v("污点")]),a("code",[s._v("this-is=Bad")]),s._v("，效果为禁止调度。")]),s._v(" "),a("li",[s._v("找出拥有污点的所有主机。")]),s._v(" "),a("li",[s._v("创建一个 Pod，要求如下：\n"),a("ul",[a("li",[s._v("名称为"),a("code",[s._v("pod-bad")])]),s._v(" "),a("li",[s._v("镜像为"),a("code",[s._v("centos")]),s._v("，镜像下载策略为"),a("code",[s._v("IfNotPresent")])]),s._v(" "),a("li",[s._v("该 Pod 必须运行在 worker01 节点上")]),s._v(" "),a("li",[s._v("启动 Pod 时运行的命令为"),a("code",[s._v("sleep 9999999")])])])]),s._v(" "),a("li",[s._v("查看"),a("code",[s._v("pod-good")]),s._v("的 IP 地址，切换至 worker02 的终端窗口并使用"),a("code",[s._v("curl")]),s._v("命令请求"),a("code",[s._v("http://<IP地址>/I-am-hacker")]),s._v("。")]),s._v(" "),a("li",[s._v("查看"),a("code",[s._v("pod-good")]),s._v("的命令行输出，是否有来自 worker02 的 HTTP 请求。")]),s._v(" "),a("li",[s._v("找出内存消耗最低的节点。")]),s._v(" "),a("li",[s._v("删除"),a("code",[s._v("pod-good")]),s._v("和"),a("code",[s._v("pod-bad")]),s._v("。")])]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("答案分隔线")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("答案分隔线")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("答案分隔线")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("答案分隔线")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("答案分隔线")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("答案分隔线")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("答案分隔线")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("答案分隔线")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("答案分隔线")]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"实操练习答案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实操练习答案"}},[s._v("#")]),s._v(" 实操练习答案")]),s._v(" "),a("h4",{attrs:{id:"_1-为-worker01-和-worker02-节点都设置标签look-good。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-为-worker01-和-worker02-节点都设置标签look-good。"}},[s._v("#")]),s._v(" 1. 为 worker01 和 worker02 节点都设置"),a("b",[s._v("标签")]),a("code",[s._v("look=good")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl label nodes www.k11.com www.k12.com "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("look")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("good\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/05/01.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_2-为-worker01-节点设置标签inside-bad-为-worker02-节点设置标签inside-good。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-为-worker01-节点设置标签inside-bad-为-worker02-节点设置标签inside-good。"}},[s._v("#")]),s._v(" 2. 为 worker01 节点设置"),a("b",[s._v("标签")]),a("code",[s._v("inside=bad")]),s._v("，为 worker02 节点设置"),a("b",[s._v("标签")]),a("code",[s._v("inside=good")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl label nodes www.k11.com "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("inside")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bad\nkubectl label nodes www.k12.com "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("inside")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("good\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/05/02.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_3-列出具有标签look-good的节点。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-列出具有标签look-good的节点。"}},[s._v("#")]),s._v(" 3. 列出具有"),a("b",[s._v("标签")]),a("code",[s._v("look=good")]),s._v("的节点。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get nodes "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("look")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("good\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/05/03.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_4-为-worker02-添加注释信息this-is-good-然后列出其注释信息。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-为-worker02-添加注释信息this-is-good-然后列出其注释信息。"}},[s._v("#")]),s._v(" 4. 为 worker02 添加"),a("b",[s._v("注释")]),s._v("信息"),a("code",[s._v("this-is=Good")]),s._v("，然后列出其"),a("b",[s._v("注释")]),s._v("信息。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl annotate nodes www.k12.com this-is"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Good\n\nkubectl describe nodes www.k12.com "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/tations/,/C/'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/05/04.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_5-创建pod-good"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-创建pod-good"}},[s._v("#")]),s._v(" 5. 创建pod-good")]),s._v(" "),a("p",[s._v("创建一个 Pod，要求如下：\n+ 名称为"),a("code",[s._v("pod-good")]),s._v("\n+ 镜像为"),a("code",[s._v("nginx")]),s._v("，镜像下载策略为"),a("code",[s._v("IfNotPresent")]),s._v("\n+ 该 Pod 必须运行在 worker02 节点上\n+ 实施资源限制策略，限制 CPU 资源使用上限为"),a("code",[s._v("0.4")]),s._v("个核心，限制内存资源使用上限为"),a("code",[s._v("512")]),s._v(" MiB")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pod-good.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("good\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("inside")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" good\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("good\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("limits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 400m\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 512Mi\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/05/05.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("对于资源限制，你也可以使用 LimitRange 来完成：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" LimitRange\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" good"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("limit\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("limits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 400m\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 512Mi\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Container\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h4",{attrs:{id:"_6-为-worker01-节点设置污点this-is-bad-效果为禁止调度。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-为-worker01-节点设置污点this-is-bad-效果为禁止调度。"}},[s._v("#")]),s._v(" 6. 为 worker01 节点设置"),a("b",[s._v("污点")]),a("code",[s._v("this-is=Bad")]),s._v("，效果为禁止调度。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl taint nodes www.k11.com this-is"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Bad:NoSchedule\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/05/06.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_7-找出拥有污点的所有主机。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-找出拥有污点的所有主机。"}},[s._v("#")]),s._v(" 7. 找出拥有污点的所有主机。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl describe nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/Taint/,/Ho/'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/Taints/-------------------------\\nTaints/g'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("列出节点名称以及对应的污点。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("awk '/Taint/,/Ho/'")]),s._v(" 匹配 “Taint” 到 “Ho...” 之间的所有字符")]),s._v(" "),a("li",[a("code",[s._v("sed '...'")]),s._v(" 将字符 “Taints” 替换为 “-----\\nTaints”")])]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/05/07.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("以下是一些统计污点主机数量的方法。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# grep -c统计没有污点的主机数量")]),s._v("\nkubectl describe nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/Taint/,/Ho/'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/Taints/-------------------------\\nTaints/g'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<none>'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("一个比较流行的统计方法：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("$(kubectl get nodes | grep Ready | awk '{print $1}')")]),s._v("：列出所有状态为 “Ready” 的节点，并通过"),a("code",[s._v("awk")]),s._v("打印它们的主机名称")]),s._v(" "),a("li",[a("code",[s._v("kubectl describe nodes")]),s._v("：依次接收主机名称，列出每个节点的详细信息")]),s._v(" "),a("li",[a("code",[s._v("grep -i Taint")]),s._v("：查找污点")]),s._v(" "),a("li",[a("code",[s._v("grep -c NoSchedule")]),s._v("：统计污点主机的数量")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl describe nodes "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" Ready "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $1}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" Taint "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" NoSchedule\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_8-创建pod-bad"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-创建pod-bad"}},[s._v("#")]),s._v(" 8. 创建pod-bad")]),s._v(" "),a("p",[s._v("创建一个 Pod，要求如下：\n+ 名称为"),a("code",[s._v("pod-bad")]),s._v("\n+ 镜像为"),a("code",[s._v("centos")]),s._v("，镜像下载策略为"),a("code",[s._v("IfNotPresent")]),s._v("\n+ 该 Pod 必须运行在 worker01 节点上\n+ 启动 Pod 时运行的命令为"),a("code",[s._v("sleep 9999999")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pod-bad.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("bad\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("inside")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" bad\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tolerations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Equal"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"this-is"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Bad"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("effect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NoSchedule"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" centos\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("bad\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sh'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-c'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sleep 9999999'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/05/08.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_9-查看pod-good的-ip-地址-切换至-worker02-的终端窗口并使用curl命令请求http-ip地址-i-am-hacker。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-查看pod-good的-ip-地址-切换至-worker02-的终端窗口并使用curl命令请求http-ip地址-i-am-hacker。"}},[s._v("#")]),s._v(" 9.  查看"),a("code",[s._v("pod-good")]),s._v("的 IP 地址，切换至 worker02 的终端窗口并使用"),a("code",[s._v("curl")]),s._v("命令请求"),a("code",[s._v("http://<IP地址>/I-am-hacker")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# master")]),s._v("\nkubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" wide\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("10.244.173.96")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/05/09.png",alt:"Not Found Image"}}),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# worker02")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://10.244.173.96/I-am-hacker\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/05/10.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_10-查看pod-good的命令行输出-是否有来自-worker02-的-http-请求。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-查看pod-good的命令行输出-是否有来自-worker02-的-http-请求。"}},[s._v("#")]),s._v(" 10. 查看"),a("code",[s._v("pod-good")]),s._v("的命令行输出，是否有来自 worker02 的 HTTP 请求。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl logs pod-good\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/05/11.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_11-找出内存消耗最低的节点。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-找出内存消耗最低的节点。"}},[s._v("#")]),s._v(" 11. 找出内存消耗最低的节点。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" nodes --sort-by"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("memory\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/05/12.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_12-删除pod-good和pod-bad。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-删除pod-good和pod-bad。"}},[s._v("#")]),s._v(" 12. 删除"),a("code",[s._v("pod-good")]),s._v("和"),a("code",[s._v("pod-bad")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl delete pods pod-good pod-bad "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--force")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/05/13.png",alt:"Not Found Image"}})])}),[],!1,null,null,null);a.default=n.exports}}]);