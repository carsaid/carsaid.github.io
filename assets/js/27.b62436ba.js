(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{343:function(s,e,a){"use strict";a.r(e);var t=a(7),r=Object(t.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"课后练习题-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#课后练习题-2"}},[s._v("#")]),s._v(" 课后练习题-2")]),s._v(" "),e("h2",{attrs:{id:"理论练习-开放性试题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#理论练习-开放性试题"}},[s._v("#")]),s._v(" 理论练习（开放性试题）")]),s._v(" "),e("p",[s._v("涵盖第 4 章的内容。")]),s._v(" "),e("ol",[e("li",[s._v("小明部署了一个 kubernetes v1.23 版本的集群，现在他想"),e("b",[s._v("直接")]),s._v("从 v1.23 更新至 v1.26 版本，可以吗？")]),s._v(" "),e("li",[s._v("kubernetes 的升级顺序是怎样的？")])]),s._v(" "),e("details",{staticClass:"custom-block details"},[e("summary",[s._v("答案")]),s._v(" "),e("ol",[e("li",[s._v("不可以，因为 kubernetes 不能跨版本升级。")]),s._v(" "),e("li",[s._v("先升 master、后升 worker。软件 kubeadm 优先，集群组件排中间，kubectl 和 kubelet 靠边。")])])]),s._v(" "),e("h2",{attrs:{id:"实操练习"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实操练习"}},[s._v("#")]),s._v(" 实操练习")]),s._v(" "),e("p",[s._v("涵盖第 1 章和第 4 章的内容。")]),s._v(" "),e("ol",[e("li",[s._v("根据前面所学，尝试自己部署一个新的集群，选择 v1.27.1 版本。")]),s._v(" "),e("li",[s._v("如果你跟随前面几章的学习路径，则你现在的集群版本应该为 v1.27.6。现在，请你将现有集群升级至 v1.28 版本（只要是 1.28 就可以，不管是 1.28.0 还是 1.28.1 还是 1.28.2）。")])]),s._v(" "),e("p",[s._v("完成第二个练习之后，你的现有集群版本应该为 v1.28.X，这将用于之后的章节学习和练习：")]),s._v(" "),e("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/update/1.28/02.png",alt:"Not Found Image"}}),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("答案分隔线")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("答案分隔线")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("答案分隔线")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("答案分隔线")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("答案分隔线")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("答案分隔线")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("答案分隔线")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("答案分隔线")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("答案分隔线")]),s._v(" "),e("hr"),s._v(" "),e("h2",{attrs:{id:"实操练习答案"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实操练习答案"}},[s._v("#")]),s._v(" 实操练习答案")]),s._v(" "),e("h3",{attrs:{id:"升级master"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#升级master"}},[s._v("#")]),s._v(" 升级master")]),s._v(" "),e("p",[s._v("1、升级 kubeadm 软件：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" kubeadm-1.28.2-0 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--disableexcludes")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("2、将 master 设置成维护模式：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl drain www.k10.com "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--force")]),s._v(" --ignore-daemonsets --delete-emptydir-data\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("3、升级 master 上的集群组件：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubeadm upgrade apply v1.28.2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("4、升级 kubectl 和 kubelet 软件，然后重启 kubelet 服务：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" kubectl-1.28.2-0 kubelet-1.28.2-0 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--disableexcludes")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n\nsystemctl daemon-reload   "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重载现有服务")]),s._v("\nsystemctl restart kubelet "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启kubelet服务")]),s._v("\nsystemctl status kubelet  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看kubelet服务状态")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("5、取消 master 的维护模式：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl uncordon www.k10.com\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("至此，master 的升级已经完成。是的就是这么简单，只需要以上 5 个步骤。")]),s._v(" "),e("p",[s._v("此外，还有一些你可能感兴趣的命令：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看集群升级计划")]),s._v("\nkubeadm upgrade plan\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 升级集群组件时，不升级 etcd 组件（标志符 --etcd-upgrade=false）")]),s._v("\nkubeadm upgrade apply v1.28.2 --etcd-upgrade"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在升级 master 上的组件之前，提前下载镜像")]),s._v("\nkubeadm config images pull\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("在完成 master 节点的升级之后，你的 master 应该已经来到了 v1.28.X 版本：")]),s._v(" "),e("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/update/1.28/01.png",alt:"Not Found Image"}}),s._v(" "),e("h3",{attrs:{id:"升级worker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#升级worker"}},[s._v("#")]),s._v(" 升级worker")]),s._v(" "),e("p",[s._v("1、升级 kubeadm 软件：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" kubeadm-1.28.2-0 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--disableexcludes")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("2、在 master 上运行 kubectl，将 worker 设置成维护模式：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl drain "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("节点名称"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--force")]),s._v(" --ignore-daemonsets --delete-emptydir-data\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("3、升级 worker 上的集群组件：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意！！！worker 和 master 的组件升级命令是不同的！")]),s._v("\nkubeadm upgrade "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("4、升级 kubectl 和 kubelet 软件，然后重启 kubelet 服务：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" kubectl-1.28.2-0 kubelet-1.28.2-0 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--disableexcludes")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n\nsystemctl daemon-reload   "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重载现有服务")]),s._v("\nsystemctl restart kubelet "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启kubelet服务")]),s._v("\nsystemctl status kubelet  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看kubelet服务状态")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("5、在 master 上运行 kubectl，取消 worker 的维护模式：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl uncordon "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("节点名称"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("worker 的升级同样只需要以上 5 个步骤。请你以同样的方式，对其余 worker 进行升级。")]),s._v(" "),e("p",[s._v("在完成所有节点的升级之后，你的集群应该来到了 v1.28.X 版本：")]),s._v(" "),e("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/update/1.28/02.png",alt:"Not Found Image"}})])}),[],!1,null,null,null);e.default=r.exports}}]);