(window.webpackJsonp=window.webpackJsonp||[]).push([[121],{436:function(e,a,t){"use strict";t.r(a);var r=t(7),s=Object(r.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[e._v("学习更多")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/tutorials/security/apparmor/",target:"_blank",rel:"noopener noreferrer"}},[e._v("官方文档-使用 AppArmor 限制容器对资源的访问"),a("OutboundLink")],1)])]),e._v(" "),a("h2",{attrs:{id:"容器-apparmor-设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#容器-apparmor-设置"}},[e._v("#")]),e._v(" 容器 AppArmor 设置")]),e._v(" "),a("p",[e._v("AppArmor 配置文件是按逐个容器的形式来设置的。要指定用来运行 Pod 容器的 AppArmor 配置文件，请向 Pod 的 metadata 添加注释：")]),e._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("container.apparmor.security.beta.kubernetes.io/<container_name>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" <profile_ref"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[a("code",[e._v("<container_name>")]),e._v("的值是配置文件所针对的容器名称，"),a("code",[e._v("<profile_def>")]),e._v("设置要应用的配置文件。 "),a("code",[e._v("<profile_ref>")]),e._v("可以是以下取值之一：")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("runtime/default")]),e._v("应用运行时的默认配置")]),e._v(" "),a("li",[a("code",[e._v("localhost/<profile_name>")]),e._v("应用在主机上加载的名为"),a("code",[e._v("<profile_name>")]),e._v("的配置文件")]),e._v(" "),a("li",[a("code",[e._v("unconfined")]),e._v("表示不加载配置文件")])]),e._v(" "),a("h2",{attrs:{id:"验证-apparmor-设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证-apparmor-设置"}},[e._v("#")]),e._v(" 验证 AppArmor 设置")]),e._v(" "),a("p",[e._v("要验证是否应用了配置文件，可以在容器创建事件中查找所列出的 AppArmor 安全选项：")]),e._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl get events "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("grep")]),e._v(" Created\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("另一种验证方式，你还可以通过检查容器的 proc attr，直接验证容器的根进程是否以正确的配置文件运行：")]),e._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("pod_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" -- "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" /proc/1/attr/current\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])])])}),[],!1,null,null,null);a.default=s.exports}}]);