(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{336:function(s,a,t){"use strict";t.r(a);var e=t(7),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"课后练习题-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#课后练习题-4"}},[s._v("#")]),s._v(" 课后练习题-4")]),s._v(" "),a("h2",{attrs:{id:"理论练习-开放性试题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#理论练习-开放性试题"}},[s._v("#")]),s._v(" 理论练习（开放性试题）")]),s._v(" "),a("p",[s._v("涵盖第 6 章的内容。")]),s._v(" "),a("ol",[a("li",[s._v("什么是延迟删除期（宽限期）？")]),s._v(" "),a("li",[s._v("Pod 钩子是什么？")]),s._v(" "),a("li",[s._v("为什么需要资源限制？")]),s._v(" "),a("li",[s._v("如果在编写 yaml 文件的过程中，忘记了某个字段如何编写，怎么快速查看字段信息？")])]),s._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[s._v("答案")]),s._v(" "),a("ol",[a("li",[s._v("在删除 Pod 的时候给予它一点时间，等待 Pod 将手头上的任务处理完成，以实现优雅地关闭 Pod。")]),s._v(" "),a("li",[s._v("钩子可以在容器启动之后，或在容器被删除之前，执行一些特定的任务。")]),s._v(" "),a("li",[s._v("防止 Pod/容器 占用过多计算机资源，导致物理机出现卡顿、宕机等情况。")]),s._v(" "),a("li",[s._v("通过"),a("code",[s._v("kubectl explain")]),s._v("命令，查询格式为"),a("code",[s._v("kubectl explain <资源类型>.<字段>")])])])]),s._v(" "),a("h2",{attrs:{id:"实操练习"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实操练习"}},[s._v("#")]),s._v(" 实操练习")]),s._v(" "),a("p",[s._v("涵盖第 6 的内容。")]),s._v(" "),a("ol",[a("li",[s._v("创建一个 ResourceQuota，要求如下：\n"),a("ul",[a("li",[s._v("ResourceQuota 名称为"),a("code",[s._v("my-quota")])]),s._v(" "),a("li",[s._v("限制命名空间"),a("code",[s._v("default")]),s._v("中最多只能存在"),a("code",[s._v("3")]),s._v("个 Pod")])])]),s._v(" "),a("li",[s._v("创建一个 Pod，要求如下：\n"),a("ul",[a("li",[s._v("Pod 名称为"),a("code",[s._v("pod-stop")])]),s._v(" "),a("li",[s._v("命名空间为"),a("code",[s._v("default")])]),s._v(" "),a("li",[s._v("容器镜像为"),a("code",[s._v("nginx")]),s._v("，镜像下载策略为"),a("code",[s._v("IfNotPresent")])]),s._v(" "),a("li",[s._v("宽限期设置为"),a("code",[s._v("120")]),s._v("秒")]),s._v(" "),a("li",[s._v("配置一个结束钩子，在删除 Pod 的时候使用命令"),a("code",[s._v("/usr/sbin/nginx -s quit")]),s._v("优雅地关闭 nginx 进程")])])]),s._v(" "),a("li",[s._v("创建一个 Pod，要求如下：\n"),a("ul",[a("li",[s._v("Pod 名称为"),a("code",[s._v("pod-start")])]),s._v(" "),a("li",[s._v("命名空间为"),a("code",[s._v("default")])]),s._v(" "),a("li",[s._v("容器镜像为"),a("code",[s._v("nginx")]),s._v("，镜像下载策略为"),a("code",[s._v("IfNotPresent")])]),s._v(" "),a("li",[s._v("配置一个启动钩子，在创建 Pod 之后修改 nginx 默认的首页内容为"),a("code",[s._v("Hello nginx!")]),s._v("（首页文件位于"),a("code",[s._v("/usr/share/nginx/html/index.html")]),s._v("）")]),s._v(" "),a("li",[s._v("对该 Pod 施加资源限制策略，CPU 使用上限为"),a("code",[s._v("1.2")]),s._v("个核心，内存使用上限为"),a("code",[s._v("1.5")]),s._v("GiB")])])]),s._v(" "),a("li",[s._v("创建一个 LimitRange，要求如下：\n"),a("ul",[a("li",[s._v("LimitRange 名称为"),a("code",[s._v("my-limit")])]),s._v(" "),a("li",[s._v("命名空间为"),a("code",[s._v("default")])]),s._v(" "),a("li",[s._v("设置 CPU 使用上限为"),a("code",[s._v("0.8")]),s._v("个核心，内存使用上限为"),a("code",[s._v("400")]),s._v(" MiB")]),s._v(" "),a("li",[s._v("限制对象为 “容器”")])])]),s._v(" "),a("li",[s._v("创建一个 Pod，要求如下：\n"),a("ul",[a("li",[s._v("Pod 名称为"),a("code",[s._v("pod-memload")])]),s._v(" "),a("li",[s._v("命名空间为"),a("code",[s._v("default")])]),s._v(" "),a("li",[s._v("容器镜像为"),a("code",[s._v("centos")]),s._v("，镜像下载策略为"),a("code",[s._v("IfNotPresent")])])])]),s._v(" "),a("li",[s._v("将内存压力测试工具"),a("code",[s._v("memload")]),s._v("的安装包拷贝到 Pod "),a("code",[s._v("pod-memload")]),s._v("中，在容器中安装工具并运行：\n"),a("ul",[a("li",[s._v("运行"),a("code",[s._v("memload")]),s._v("并申请"),a("code",[s._v("800")]),s._v(" M 的内存，然后查看 Pod 负载信息")]),s._v(" "),a("li",[s._v("如果无法申请到 800M 的内存，则改为申请"),a("code",[s._v("350")]),s._v(" M 的内存，然后查看 Pod 负载信息")])])]),s._v(" "),a("li",[s._v("通过命令行在命名空间"),a("code",[s._v("default")]),s._v("创建一个 Pod，看看能否创建成功。")]),s._v(" "),a("li",[s._v("在命名空间"),a("code",[s._v("ns1")]),s._v("创建一个 Pod，看看能否创建成功。")]),s._v(" "),a("li",[s._v("查看"),a("code",[s._v("pod-start")]),s._v("的 IP 地址，然后通过"),a("code",[s._v("curl")]),s._v("请求网站首页，看看内容是否为"),a("code",[s._v("Hello nginx!")])]),s._v(" "),a("li",[s._v("删除"),a("code",[s._v("my-quota")]),s._v("、"),a("code",[s._v("my-limit")]),s._v("和所有 Pod")])]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("答案分隔线")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("答案分隔线")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("答案分隔线")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("答案分隔线")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("答案分隔线")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("答案分隔线")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("答案分隔线")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("答案分隔线")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("答案分隔线")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("答案分隔线")]),s._v(" "),a("h2",{attrs:{id:"实操练习答案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实操练习答案"}},[s._v("#")]),s._v(" 实操练习答案")]),s._v(" "),a("h4",{attrs:{id:"_0-切换集群命名空间为default"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0-切换集群命名空间为default"}},[s._v("#")]),s._v(" 0. 切换集群命名空间为"),a("code",[s._v("default")])]),s._v(" "),a("p",[s._v("不是必须步骤，选做。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl config set-context "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--current")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--namespace")]),s._v(" default\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_1-创建-resourcequota"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建-resourcequota"}},[s._v("#")]),s._v(" 1. 创建 ResourceQuota")]),s._v(" "),a("p",[s._v("创建一个 ResourceQuota，要求如下：\n* ResourceQuota 名称为"),a("code",[s._v("my-quota")]),s._v("\n* 限制命名空间"),a("code",[s._v("default")]),s._v("中最多只能存在"),a("code",[s._v("3")]),s._v("个 Pod")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ResourceQuota\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("quota\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hard")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pods")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/04/01.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_2-创建第一个pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建第一个pod"}},[s._v("#")]),s._v(" 2. 创建第一个Pod")]),s._v(" "),a("p",[s._v("创建一个 Pod，要求如下：\n* Pod 名称为"),a("code",[s._v("pod-stop")]),s._v("\n* 命名空间为"),a("code",[s._v("default")]),s._v("\n* 容器镜像为"),a("code",[s._v("nginx")]),s._v("，镜像下载策略为"),a("code",[s._v("IfNotPresent")]),s._v("\n* 宽限期设置为"),a("code",[s._v("120")]),s._v("秒\n* 配置一个结束钩子，在删除 Pod 的时候使用命令"),a("code",[s._v("/usr/sbin/nginx -s quit")]),s._v("优雅地关闭 nginx 进程")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stop\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("terminationGracePeriodSeconds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stop\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("lifecycle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("preStop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sh'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-c'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/usr/sbin/nginx -s quit'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/04/02.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_3-创建第二个pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建第二个pod"}},[s._v("#")]),s._v(" 3. 创建第二个Pod")]),s._v(" "),a("p",[s._v("创建一个 Pod，要求如下：\n* Pod 名称为"),a("code",[s._v("pod-start")]),s._v("\n* 命名空间为"),a("code",[s._v("default")]),s._v("\n* 容器镜像为"),a("code",[s._v("nginx")]),s._v("，镜像下载策略为"),a("code",[s._v("IfNotPresent")]),s._v("\n* 配置一个启动钩子，在创建 Pod 之后修改 nginx 默认的首页内容为"),a("code",[s._v("Hello nginx!")]),s._v("（首页文件位于"),a("code",[s._v("/usr/share/nginx/html/index.html")]),s._v("）\n* 对该 Pod 施加资源限制策略，CPU 使用上限为"),a("code",[s._v("1.2")]),s._v("个核心，内存使用上限为"),a("code",[s._v("1.5")]),s._v("GiB")]),s._v(" "),a("p",[s._v("注，"),a("code",[s._v("resources.limits.cpu")]),s._v("设置为"),a("code",[s._v("1.2")]),s._v("或"),a("code",[s._v("1200m")]),s._v("都对，"),a("code",[s._v("resources.limits.memory")]),s._v("设置为"),a("code",[s._v("1.5Gi")]),s._v("或"),a("code",[s._v("1536Mi")]),s._v("都对。")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("start\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("start\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("lifecycle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("postStart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sh'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-c'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'echo \"Hello nginx!\" > /usr/share/nginx/html/index.html'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("limits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1200m\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1.5Gi\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/04/03.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_4-创建limitrange"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-创建limitrange"}},[s._v("#")]),s._v(" 4. 创建LimitRange")]),s._v(" "),a("p",[s._v("创建一个 LimitRange，要求如下：\n* LimitRange 名称为"),a("code",[s._v("my-limit")]),s._v("\n* 命名空间为"),a("code",[s._v("default")]),s._v("\n* 设置 CPU 使用上限为"),a("code",[s._v("0.8")]),s._v("个核心，内存使用上限为"),a("code",[s._v("400")]),s._v(" MiB\n* 限制对象为 “容器”")]),s._v(" "),a("p",[s._v("注，"),a("code",[s._v("spec.limits.max.cpu")]),s._v("设置为"),a("code",[s._v("0.8")]),s._v("或"),a("code",[s._v("800m")]),s._v("都对。")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" LimitRange\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("limit\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("limits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 800m\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 400Mi\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Container\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/04/04.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_5-创建第三个pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-创建第三个pod"}},[s._v("#")]),s._v(" 5. 创建第三个Pod")]),s._v(" "),a("p",[s._v("创建一个 Pod，要求如下：\n* Pod 名称为"),a("code",[s._v("pod-memload")]),s._v("\n* 命名空间为"),a("code",[s._v("default")]),s._v("\n* 容器镜像为"),a("code",[s._v("centos")]),s._v("，镜像下载策略为"),a("code",[s._v("IfNotPresent")]),s._v("\n* 创建 Pod 的时候执行命令"),a("code",[s._v("sleep 99999999")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("memload\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" centos\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("memload\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sh'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-c'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sleep 99999999'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/04/05.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_6-内存压力测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-内存压力测试"}},[s._v("#")]),s._v(" 6. 内存压力测试")]),s._v(" "),a("p",[s._v("将内存压力测试工具"),a("code",[s._v("memload")]),s._v("的安装包拷贝到 Pod "),a("code",[s._v("pod-memload")]),s._v("中，在容器中安装工具并运行：\n* 运行"),a("code",[s._v("memload")]),s._v("并申请"),a("code",[s._v("800")]),s._v(" M 的内存，然后查看 Pod 负载信息\n* 如果无法申请到 800M 的内存，则改为申请"),a("code",[s._v("350")]),s._v(" M 的内存，然后查看 Pod 负载信息")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" ./memload-7.0-1.r29766.x86_64.rpm pod-memload:/opt\nkubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" pod-memload -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ivh")]),s._v(" ./memload-7.0-1.r29766.x86_64.rpm\n\nmemload "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("800")]),s._v("\nmemload "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("350")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/04/06.png",alt:"Not Found Image"}}),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# master")]),s._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" pods\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/04/07.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_7-在命名空间default创建一个pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-在命名空间default创建一个pod"}},[s._v("#")]),s._v(" 7. 在命名空间"),a("code",[s._v("default")]),s._v("创建一个Pod")]),s._v(" "),a("p",[s._v("通过命令行在命名空间"),a("code",[s._v("default")]),s._v("创建一个 Pod，看看能否创建成功。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl run pod-default "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" nginx --image-pull-policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("IfNotPresent\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("创建失败，Pod 配额达到上限。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/04/08.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_8-在命名空间ns1创建一个pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-在命名空间ns1创建一个pod"}},[s._v("#")]),s._v(" 8. 在命名空间"),a("code",[s._v("ns1")]),s._v("创建一个Pod")]),s._v(" "),a("p",[s._v("在命名空间"),a("code",[s._v("ns1")]),s._v("创建一个 Pod，看看能否创建成功。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl run pod-ns1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" nginx --image-pull-policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("IfNotPresent "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" ns1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("创建成功，Pod 正常运行。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/04/09.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_9-查看pod-start的-ip-地址-然后通过curl请求网站首页-看看内容是否为hello-nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-查看pod-start的-ip-地址-然后通过curl请求网站首页-看看内容是否为hello-nginx"}},[s._v("#")]),s._v(" 9. 查看"),a("code",[s._v("pod-start")]),s._v("的 IP 地址，然后通过"),a("code",[s._v("curl")]),s._v("请求网站首页，看看内容是否为"),a("code",[s._v("Hello nginx!")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" wide\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("IP地址"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/04/10.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_10-删除my-quota、my-limit和所有-pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-删除my-quota、my-limit和所有-pod"}},[s._v("#")]),s._v(" 10. 删除"),a("code",[s._v("my-quota")]),s._v("、"),a("code",[s._v("my-limit")]),s._v("和所有 Pod")]),s._v(" "),a("p",[s._v("删除方式一，依次删除。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ResourceQuota")]),s._v("\nkubectl delete resourcequota my-quota\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# LimitRange")]),s._v("\nkubectl delete limitrange my-limit\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Pod")]),s._v("\nkubectl delete pods pod-stop pod-start pod-memload\n\nkubectl delete pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" ns1 pod-ns1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("删除方式二，通过 yaml 文件批量删除。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl delete "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--force")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/practice/04/11.png",alt:"Not Found Image"}})])}),[],!1,null,null,null);a.default=n.exports}}]);