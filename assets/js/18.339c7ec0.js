(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{334:function(s,a,t){"use strict";t.r(a);var e=t(7),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"cardListContainer"},[a("div",{staticClass:"card-list"},[a("span",{staticClass:"card-item row-2",staticStyle:{"background-color":"#F0DFB1","--randomColor":"#F0DFB1",color:"#1078E6"}},[a("div",[a("p",{staticClass:"name"},[s._v("原创")]),s._v(" "),a("p",{staticClass:"desc"},[s._v("本博客原创文章，转载请注明出处")])])])]),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 原创\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("desc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 本博客原创文章，转载请注明出处\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bgColor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#F0DFB1'")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("textColor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#1078E6'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])]),a("h1",{attrs:{id:"第5章-pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第5章-pod"}},[s._v("#")]),s._v(" 第5章-Pod")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("本章要点")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("查看、创建、删除及操作 Pod")])]),s._v(" "),a("tr",[a("td",[s._v("初始化 Pod")])]),s._v(" "),a("tr",[a("td",[s._v("静态 Pod")])])])]),s._v(" "),a("h2",{attrs:{id:"_1-查看pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-查看pod"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"1"}}),s._v("1. 查看Pod")],1),s._v(" "),a("p",[a("b",[s._v("1. 查看当前有多少 Pod（默认只列出当前命名空间里的 Pod）：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get pods\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("b",[s._v("2. 列出指定命名空间里的 Pod：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" kube-system\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("b",[s._v("3. 列出所有命名空间里的 Pod：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 完整写法")]),s._v("\nkubectl get pods --all-namespaces\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("以上几个命令在之前的章节中已经使用过，下面介绍其它一些常用的标志符。")]),s._v(" "),a("p",[a("b",[s._v("4. 列出 Pod 的同时显示这些 Pod 的基础信息：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" wide\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("从图中可以看到，在添加标志符"),a("code",[s._v("-o wide")]),s._v("后多出了几列信息。这些信息反馈了当前 Pod 运行在哪台主机上、运行在该主机上的哪个网段中等。")]),s._v(" "),a("p",[s._v("当你想知道一个 Pod 位于何处时，该标志符非常有用。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/get-pods/01.png",alt:"Not Found Image"}}),s._v(" "),a("p",[a("b",[s._v("5. 只列出 Pod 的名称：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" name\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果你只想获取 Pod 的名称，而不想看到其它的运行信息，则可以使用以上命令。")]),s._v(" "),a("p",[s._v("同时还可以通过管道符"),a("code",[s._v("|")]),s._v("以及命令"),a("code",[s._v("wc -l")]),s._v("来统计 Pod 的数量，这非常方便。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/get-pods/02.png",alt:"Not Found Image"}}),s._v(" "),a("p",[a("b",[s._v("6. 显示 Pod 的标签信息：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get pods --show-labels\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("从图中可以看到，这些 Pod 都具有不同的标签，不同的标签通过逗号来分隔。通过识别这些标签，你可以快速判断出某个 Pod 的作用、位置等信息，例如标签"),a("code",[s._v("tier=control-plane")]),s._v("表明这个 Pod 是运行在 master 节点上的。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/get-pods/03.png",alt:"Not Found Image"}}),s._v(" "),a("p",[a("b",[s._v("7. 列出含有特定标签的 Pod：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多个标签之间通过逗号 , 分隔")]),s._v("\nkubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("看，标签的作用这不就来了吗？")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/get-pods/04.png",alt:"Not Found Image"}}),s._v(" "),a("p",[a("b",[s._v("8. 列出 Pod 的工作负载（该命令在第 2 章中已经介绍过）：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" pods\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("b",[s._v("9. 以 JSON 或 yaml 的格式输出 Pod 的详细运行信息：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" json\nkubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" yaml\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 数据量可能过大, 建议配合输出重定向来使用")]),s._v("\nkubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" result.json\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("这里我添加了"),a("code",[s._v("-A")]),s._v("和"),a("code",[s._v("-o json")]),s._v("标志符，以 JSON 格式输出所有命名空间里的 Pod 的运行信息。由于数据量过大，所以我将其保存到了外部文件当中。")]),s._v(" "),a("p",[s._v("以下动图演示了这条命令：")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/get-pods/05.gif",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("从图中可以看到，仅仅 14 个 Pod 的运行信息就有将近五千行之多。")]),s._v(" "),a("h2",{attrs:{id:"_2-创建pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建pod"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"2"}}),s._v("2. 创建Pod")],1),s._v(" "),a("p",[s._v("之前查看的那些 Pod 都是集群自带的，你一定很想创建一个属于你自己的 Pod 吧？")]),s._v(" "),a("p",[s._v("Pod 和容器一样，也需要依靠镜像来创建，所以我们先下载几个镜像：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 由于网络原因, 下载可能会很慢, 需要耐心等待")]),s._v("\nctr "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" k8s.io i pull docker.io/library/nginx:latest\nctr "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" k8s.io i pull docker.io/library/nginx:1.9\nctr "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" k8s.io i pull docker.io/library/busybox:latest\nctr "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" k8s.io i pull docker.io/library/alpine:latest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[s._v("官方的提醒")]),s._v(" "),a("p",[s._v("在生产环境中部署容器时，应避免使用"),a("code",[s._v(":latest")]),s._v("标记，因为很难跟踪正在运行的镜像版本，也很难正确回滚。")])]),s._v(" "),a("p",[s._v("前面说过，ctr 是安装 containerd 时自带的一款命令行工具，可用于管理容器镜像。同时 ctr 具有命名空间概念，与 kubernetes 有关的镜像都需要放在"),a("code",[s._v("k8s.io")]),s._v("命名空间当中。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/create-pods/01.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("完成全部下载之后，你应该已经拥有了四个来自 docker.io 存储库的镜像。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ctr "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" k8s.io i "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" library\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/create-pods/02.png",alt:"Not Found Image"}}),s._v(" "),a("h3",{attrs:{id:"_2-1-通过命令行创建pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-通过命令行创建pod"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"2.1"}}),s._v("2.1 通过命令行创建Pod")],1),s._v(" "),a("p",[s._v("我们先来看看创建 Pod 的命令语法：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 语法")]),s._v("\nkubectl run "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("镜像"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkubectl run "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("镜像"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --image-pull-policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("镜像下载策略"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("你可能会注意到"),a("code",[s._v("--image-pull-policy")]),s._v("标志符，它指定了创建 Pod 时的镜像下载策略，共有三种策略：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("IfNotPresent")]),s._v("："),a("b",[s._v("如果本地没有才去下载镜像")]),s._v("。如果本地存在相应的镜像，则使用本地镜像来创建 Pod；如果本地没有镜像，则尝试下载该镜像，然后再创建 Pod")]),s._v(" "),a("li",[a("code",[s._v("Always")]),s._v("："),a("b",[s._v("总是下载镜像")]),s._v("。不管本地有没有镜像，都会去下载镜像，然后用所下载的镜像来创建 Pod")]),s._v(" "),a("li",[a("code",[s._v("Never")]),s._v("："),a("b",[s._v("从不下载镜像")]),s._v("。只当本地存在镜像的时候，才创建 Pod")])]),s._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[s._v("笔记")]),s._v(" "),a("p",[s._v("一些选项必须通过等于号"),a("code",[s._v("=")]),s._v("来指定，不能使用空格。")])]),s._v(" "),a("p",[s._v("默认的下载策略一般为"),a("code",[s._v("Always")]),s._v("，我们刚刚已经下载过镜像了，所以这里手动指定策略为"),a("code",[s._v("IfNotPresent")]),s._v("，以免二次下载镜像。")]),s._v(" "),a("p",[s._v("创建一个名为 “pod1” 的 Pod，同时指定镜像下载策略为 “IfNotPresent”：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 嫌命令太长的话可以通过 Tab 键自动补全, 该功能在第 2 章中已经设置过了")]),s._v("\nkubectl run pod1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" nginx --image-pull-policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("IfNotPresent\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("等待一会后，你就可以看到一个新鲜出炉的 Pod，它被调度到了 worker02 节点上运行。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/create-pods/03.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("我们来创建第二个 Pod，这次的操作不太一样：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建命名空间 ns1")]),s._v("\nkubectl create ns ns1\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 Pod 并将其命名空间指定为 ns1")]),s._v("\nkubectl run pod2 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" nginx --image-pull-policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("IfNotPresent "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" ns1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("创建 pod2 之后我们查看一下，你会发现还是只有 pod1 的信息，那 pod2 呢？创建失败了吗？")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/create-pods/04.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("我们刚刚位于命名空间"),a("code",[s._v("default")]),s._v("当中，而"),a("code",[s._v("kubectl get pods")]),s._v("命令默认只会列出当前命名空间中的 Pod，自然看不到命名空间"),a("code",[s._v("ns1")]),s._v("中的 Pod 啦。")]),s._v(" "),a("p",[s._v("这次我们为命令加上"),a("code",[s._v("-n ns1")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" ns1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这次顺利看到了 pod2。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/create-pods/05.png",alt:"Not Found Image"}}),s._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[s._v("笔记")]),s._v(" "),a("p",[s._v("如果没有指定"),a("code",[s._v("-n")]),s._v("选项，那么你当前所处的命名空间是哪个，创建的 Pod 就会在哪个命名空间中运行。")])]),s._v(" "),a("h3",{attrs:{id:"_2-2-通过yaml文件创建pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-通过yaml文件创建pod"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"2.2"}}),s._v("2.2 通过yaml文件创建Pod")],1),s._v(" "),a("p",[s._v("kubernetes 通过 yaml（"),a("code",[s._v(".yaml")]),s._v("）文件来定义和创建各种集群资源。在第 2 章中我们配置并优化了 vim 编辑器，这将有助于你编写 yaml 文件。")]),s._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[s._v("学习更多")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.runoob.com/w3cnote/yaml-intro.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("菜鸟教程-yaml入门"),a("OutboundLink")],1)])]),s._v(" "),a("p",[s._v("我们先创建一个目录，把相关的 yaml 文件都放在该目录中。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" pod-yaml\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" pod-yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/create-pods/06.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("然后，你可以通过以下命令快速生成一个用于创建 Pod 的 yaml 文件：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("--dry-run=client")]),s._v("：试运行，在本地模拟创建一个 Pod，并不会真的创建")]),s._v(" "),a("li",[a("code",[s._v("-o yaml")]),s._v("：以 yaml 格式导出该 Pod 的所有配置项")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl run "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("镜像"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --dry-run"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("client "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" pod.yaml\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" pod.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("导出文件后，你可通过 vim 来打开该文件。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/create-pods/07.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("打开文件之后，你将看到以下内容：")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/create-pods/08.png",alt:"Not Found Image"}}),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creationTimestamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token null important"}},[s._v("null")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dnsPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterFirst\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restartPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Always\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h4",{attrs:{id:"apiversion参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apiversion参数"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"2.2.1"}}),s._v("apiVersion参数")],1),s._v(" "),a("p",[s._v("该参数用于指定 Pod 的 API 版本，一般是固定的"),a("code",[s._v("v1")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("你还记得"),a("code",[s._v("kubectl api-versions")]),s._v("命令吗？它列出了 k8s 里所有可用的 apiVersion 参数值。")]),s._v(" "),a("h4",{attrs:{id:"kind参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kind参数"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"2.2.2"}}),s._v("kind参数")],1),s._v(" "),a("p",[s._v("该参数用于指定当前 yaml 文件所创建的 k8s 资源类型。参数值采用驼峰命名法，英文首字母需要大写，否则会创建失败。")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("资源类型和 apiVersion 的值是对应的，不同的资源都有不同的 apiVersion 来搭配，例如 Pod 资源必须对应 v1 版本。")]),s._v(" "),a("h4",{attrs:{id:"metadata参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#metadata参数"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"2.2.3"}}),s._v("metadata参数")],1),s._v(" "),a("p",[s._v("该参数用于指定当前资源的元数据信息。")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creationTimestamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token null important"}},[s._v("null")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("code",[s._v("metadata.creationTimestamp")]),s._v("是一个时间戳，表示创建此资源时的服务器时间。它以 RFC3339 形式表示，并采用 UTC。它可以指定为 null（空）。")]),s._v(" "),a("p",[a("code",[s._v("metadata.labels")]),s._v("是一个对象，用于定义资源的多个标签，定义标签的格式为"),a("code",[s._v("<key>: <value>")]),s._v("。这就是之前通过命令"),a("code",[s._v("kubectl get pods --show-labels")]),s._v("所看到的那些标签。")]),s._v(" "),a("p",[a("code",[s._v("metadata.name")]),s._v("用于定义资源的名称。")]),s._v(" "),a("h4",{attrs:{id:"spec参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spec参数"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"2.2.4"}}),s._v("spec参数")],1),s._v(" "),a("p",[s._v("该参数定义了 Pod 中的容器以及各种策略。")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dnsPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterFirst\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restartPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Always\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("code",[s._v("spec.containers")]),s._v("是一个数组 + 对象的复合结构，用于定义单个 Pod 中的多个容器。每个对象的第一个参数都需要以符号"),a("code",[s._v("-")]),s._v("开头，表示这是一个新容器的开始。")]),s._v(" "),a("p",[a("code",[s._v("spec.containers.image")]),s._v("定义容器所使用的镜像。")]),s._v(" "),a("p",[a("code",[s._v("spec.containers.name")]),s._v("定义容器名称，该名称与"),a("code",[s._v("metadata.name")]),s._v("是不同的。一个是 Pod 名称，一个是 Pod 中某个容器的名称。")]),s._v(" "),a("p",[a("code",[s._v("spec.containers.resources")]),s._v("定义容器资源限制，这将在后面的内容中介绍。")]),s._v(" "),a("p",[a("code",[s._v("spec.dnsPolicy")]),s._v("定义 DNS 策略。")]),s._v(" "),a("p",[a("code",[s._v("spec.restartPolicy")]),s._v("定义 Pod 重启策略，在这里为 Always（遇到故障之后，总是重启）。")]),s._v(" "),a("h4",{attrs:{id:"_2-2-5-应用yaml并创建pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-应用yaml并创建pod"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"2.2.5"}}),s._v("2.2.5 应用yaml并创建Pod")],1),s._v(" "),a("p",[s._v("在创建 Pod 之前先打开文件，在原有的条目下方添加镜像下载策略：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("此外，你也可以在执行命令的时候添加"),a("code",[s._v("--image-pull-policy")]),s._v("选项，这样镜像下载策略会一同被导出至 yaml 文件当中。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/create-pods/09.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("运行以下命令，从一个文件中创建 Pod：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("文件名"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("成功创建了一个名为 pod-y 的 Pod。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/create-pods/10.png",alt:"Not Found Image"}}),s._v(" "),a("h3",{attrs:{id:"_2-3-关于镜像下载策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-关于镜像下载策略"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"2.3"}}),s._v("2.3 关于镜像下载策略")],1),s._v(" "),a("p",[s._v("在命令行中创建 Pod 时，可以通过标志符"),a("code",[s._v("--image-pull-policy")]),s._v("来指定镜像下载策略。通过 yaml 文件创建 Pod 时，可以通过参数"),a("code",[s._v("spec.containers.imagePullPolicy")]),s._v("来指定镜像下载策略。")]),s._v(" "),a("p",[s._v("通过前面的介绍，得知镜像下载策略有三个值："),a("code",[s._v("IfNotPresent")]),s._v("、"),a("code",[s._v("Always")]),s._v(" 和 "),a("code",[s._v("Never")]),s._v("。默认的策略一般为 Always，为什么要说一般呢？网上有很多文章都说 Always 是默认的下载策略，但这并不完全正确。")]),s._v(" "),a("p",[s._v("在"),a("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/containers/images/#imagepullpolicy-defaulting",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),a("OutboundLink")],1),s._v("中详细记录了有关于 “默认镜像下载策略” 的信息。当满足某个特定条件时，你的 k8s 会自动设置一个合适的下载策略。")]),s._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[s._v("笔记")]),s._v(" "),a("p",[s._v("当你省略"),a("code",[s._v("imagePullPolicy")]),s._v("字段的情况下，如果：")]),s._v(" "),a("ul",[a("li",[s._v("没有为容器镜像指定标签，自动设置为"),a("code",[s._v("Always")])]),s._v(" "),a("li",[s._v("容器镜像的标签为"),a("code",[s._v(":latest")]),s._v("，自动设置为"),a("code",[s._v("Always")])]),s._v(" "),a("li",[s._v("为容器镜像指定了摘要，自动设置为"),a("code",[s._v("IfNotPresent")])]),s._v(" "),a("li",[s._v("为容器镜像指定了非"),a("code",[s._v(":latest")]),s._v("的标签，自动设置为"),a("code",[s._v("IfNotPresent")])])])]),s._v(" "),a("p",[s._v("两种 Always 的情况，两种 IfNotPresent 的情况。相信你现在对默认的镜像下载策略有了一个初步了解。")]),s._v(" "),a("p",[s._v("更加详细的信息可参阅"),a("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/containers/images/#imagepullpolicy-defaulting",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"_3-小练习"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-小练习"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"3"}}),s._v("3. 小练习")],1),s._v(" "),a("p",[s._v("我们来做个小练习：")]),s._v(" "),a("ul",[a("li",[s._v("通过 yaml 文件创建一个名为 pod-abc 的 Pod")]),s._v(" "),a("li",[s._v("镜像为 nginx")]),s._v(" "),a("li",[s._v("镜像下载策略为 IfNotPresent")]),s._v(" "),a("li",[s._v("命名空间为 ns1")]),s._v(" "),a("li",[s._v("添加两个标签：abc=xyz 和 hello=world")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl run pod-abc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" nginx --image-pull-policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("IfNotPresent "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" ns1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("abc")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xyz,hello"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("world --dry-run"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("client "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" abc.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("运行命令之后，将会获得以下文件内容：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creationTimestamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token null important"}},[s._v("null")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("abc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" xyz\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hello")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" world\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("abc\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ns1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("abc\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dnsPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterFirst\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restartPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Always\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("然后，运行以下命令创建该 Pod：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" abc.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("在命名空间 ns1 中可以看到刚刚创建的 pod-abc，还有之前创建的 pod2。")]),s._v(" "),a("p",[s._v("pod-abc 具有两个标签，都是我们手动指定的。我们之前没有为 pod2 打过标签，但 pod2 却有一个标签"),a("code",[s._v("run=pod2")]),s._v("。这说明，如果你没有为 Pod 指定标签，则 kubernetes 会自动为其加上一个格式为"),a("code",[s._v("run=<名称>")]),s._v("的默认标签。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/create-pods/11.png",alt:"Not Found Image"}}),s._v(" "),a("h2",{attrs:{id:"_4-删除pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-删除pod"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"4"}}),s._v("4. 删除Pod")],1),s._v(" "),a("p",[s._v("从开始到现在，我们一共创建了四个 Pod：pod1、pod2、pod-y 和 pod-abc。其中 pod1 和 pod2 都是通过命令行创建的，而 pod-y 和 pod-abc 都是通过 yaml 文件的方式创建的。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/delete-pods/01.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("删除命令的语法：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl delete pods "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 强制删除")]),s._v("\nkubectl delete pods "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--force")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("b",[s._v("1. 删除 pod1：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl delete pods pod1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("一次简单的删除。此外，你还可以通过添加"),a("code",[s._v("--force")]),s._v("来强制删除某个 Pod，以加快删除速度。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/delete-pods/02.png",alt:"Not Found Image"}}),s._v(" "),a("p",[a("b",[s._v("2. 同时删除命名空间 ns1 中的两个 Pod：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多个 Pod 之间通过空格来分隔")]),s._v("\nkubectl delete pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" ns1 pod-2 pod-abc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("我当前位于"),a("code",[s._v("default")]),s._v("命名空间中，如果想要删除 pod-2 和 pod-abc，则必须使用"),a("code",[s._v("-n")]),s._v("指定命名空间。")]),s._v(" "),a("p",[s._v("可以看到，第一次我没有指定命名空间，所以删除失败了，因为当前命名空间中没有这两个 Pod。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/delete-pods/03.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("现在只剩下 pod-y 了，这个 Pod 是通过 yaml 文件"),a("code",[s._v("pod.yaml")]),s._v("创建的。那么问题来了，我们能否基于 yaml 文件来删除某个 Pod 呢？当然可以！")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/delete-pods/04.png",alt:"Not Found Image"}}),s._v(" "),a("p",[a("b",[s._v("3. 通过 yaml 文件删除某个资源：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl delete "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("文件名"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("但是 yaml 文件中的"),a("code",[s._v("kind")]),s._v("和"),a("code",[s._v("metadata")]),s._v("参数不能有太大的偏差，否则 k8s 可能找不到对应的资源。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/delete-pods/05.png",alt:"Not Found Image"}}),s._v(" "),a("p",[a("b",[s._v("4. 删除具有某个特定标签的多个 Pod：")])]),s._v(" "),a("p",[s._v("之前的 Pod 都删光了，再创建四个 Pod，分别打上不同的标签：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl run pod1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" nginx --image-pull-policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("IfNotPresent "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("abc")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v("\nkubectl run pod2 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" nginx --image-pull-policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("IfNotPresent "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("xyz")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v("\nkubectl run pod3 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" nginx --image-pull-policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("IfNotPresent "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("xyz")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("456")]),s._v("\nkubectl run pod4 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" nginx --image-pull-policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("IfNotPresent "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("xyz")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("456")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("创建成功。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/delete-pods/06.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("然后运行以下命令，删除具有标签"),a("code",[s._v("xyz=456")]),s._v("的所有 Pod：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl delete pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("xyz")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("456")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("感受到标签的便捷性了吧。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/delete-pods/07.png",alt:"Not Found Image"}}),s._v(" "),a("h2",{attrs:{id:"_5-操作pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-操作pod"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"5"}}),s._v("5. 操作Pod")],1),s._v(" "),a("p",[s._v("现在我们来对 Pod 进行一些具体的操作。不过在那之前，我们先生成一个 Pod 的 yaml 文件：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl run ac-pod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" nginx --image-pull-policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("IfNotPresent --dry-run"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("client "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ac-pod.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("文件内容如下：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creationTimestamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token null important"}},[s._v("null")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ac"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ac"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ac"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dnsPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterFirst\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restartPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Always\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("前面提到过，一个 Pod 里可以有多个容器，怎么实现呢？")]),s._v(" "),a("p",[s._v("我们编辑这个文件的"),a("code",[s._v("spec.containers")]),s._v("参数，在原有的基础上往 Pod 里再添加一个容器：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ac1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ac2\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("前面介绍过"),a("code",[s._v("spec.containers")]),s._v("参数，它是一个数组 + 对象的复合结构，每个符号"),a("code",[s._v("-")]),s._v("都表示一个新容器的开始。")]),s._v(" "),a("p",[s._v("这里有两个"),a("code",[s._v("-")]),s._v("说明有两个容器，第一个容器以参数"),a("code",[s._v("image")]),s._v("开始，第二个容器以参数"),a("code",[s._v("name")]),s._v("开始。参数没有书写顺序要求，只要保持在符号"),a("code",[s._v("-")]),s._v("之内即可。")]),s._v(" "),a("p",[s._v("此外，如果同一个 Pod 中有多个容器，则这些容器的名称不能重复，否则会冲突，导致 Pod 创建失败。所以我这里将两个容器的"),a("code",[s._v("name")]),s._v("分别设置为了"),a("code",[s._v("ac1")]),s._v("和"),a("code",[s._v("ac2")]),s._v("。")]),s._v(" "),a("p",[s._v("完整的 yaml 文件内容如下：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creationTimestamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token null important"}},[s._v("null")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ac"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ac"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ac1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ac2\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dnsPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterFirst\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restartPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Always\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("通过以上 yaml 文件创建 Pod：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" ac-pod.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("创建成功，这个 Pod 在"),a("code",[s._v("READY")]),s._v("一栏中显示了"),a("code",[s._v("2/2")]),s._v("，表示这个 Pod 里有两个容器，且容器运行正常。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/01.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("如果显示"),a("code",[s._v("1/2")]),s._v("，表示 Pod 里有两个容器，但是只有一个容器运行正常。")]),s._v(" "),a("p",[s._v("你可能会看到 Pod 状态一直处于 “Error”（错误）之中，别担心，这是演示目的之一。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/21.png",alt:"Not Found Image"}}),s._v(" "),a("h3",{attrs:{id:"_5-1-查看pod的日志信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-查看pod的日志信息"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"5.1"}}),s._v("5.1 查看Pod的日志信息")],1),s._v(" "),a("p",[s._v("通过以下命令可以查看 Pod 中某个容器的日志信息（命令行输出信息）：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl logs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Pod名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("查看成功，这是容器内部的一些初始化信息。")]),s._v(" "),a("p",[s._v("同时在最上方有一行提示 “默认容器为 ac1，共有 ac1, ac2”。这说明，如果单个 Pod 中有多个容器，则"),a("code",[s._v("logs")]),s._v("命令默认只会查看第一个容器中的命令行输出。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/02.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("如果想要查看其它容器中的命令行输出，则需要指定"),a("code",[s._v("-c")]),s._v("选项：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看Pod中指定容器的命令行输出")]),s._v("\nkubectl logs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Pod名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("容器名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\nkubectl logs ac-pod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ac2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("通过"),a("code",[s._v("-c")]),s._v("指定容器名称为 ac2，成功看到了容器 ac2 中的命令行输出。其中包含大量的错误信息，提示 “绑定地址的 80 端口失败”。")]),s._v(" "),a("p",[s._v("在 docker 中，每个容器可能都有一个独立的 IP 地址。但是在 k8s 中，每个 Pod 拥有一个独立的 IP 地址，而 Pod 中的多个容器则会共用同一个 Pod 的 IP 地址。")]),s._v(" "),a("p",[s._v("由于单个 Pod 中的多个容器会共用一个 IP 地址，而我们创建的两个容器又都是"),a("code",[s._v("nginx")]),s._v("镜像，该镜像默认监听的端口为"),a("code",[s._v("80")]),s._v("。两个容器都想使用这个 IP 的 80 端口，这造成了冲突，导致最终只有一个容器可以正常运行。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/03.png",alt:"Not Found Image"}}),s._v(" "),a("h3",{attrs:{id:"_5-2-在pod中执行命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-在pod中执行命令"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"5.2"}}),s._v("5.2 在Pod中执行命令")],1),s._v(" "),a("h4",{attrs:{id:"_5-2-1-在已有的pod中执行命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-1-在已有的pod中执行命令"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"5.2.1"}}),s._v("5.2.1 在已有的Pod中执行命令")],1),s._v(" "),a("p",[s._v("与 docker 类似，我们可以通过"),a("code",[s._v("exec")]),s._v("命令在 Pod 的某个容器中执行命令。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Pod名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" -- "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("命令"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在指定容器中执行命令")]),s._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Pod名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("容器名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" -- "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("命令"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("就像这样：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 ac-pod 中的 ac1 容器里执行 ls -l 命令")]),s._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ac-pod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ac1 -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("你可能会很疑惑，为什么 k8s 要用"),a("code",[s._v("--")]),s._v("来分隔要执行的命令？我也很疑惑，但这是固定语法。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/04.png",alt:"Not Found Image"}}),s._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[s._v("笔记")]),s._v(" "),a("p",[s._v("符号"),a("code",[s._v("--")]),s._v("的两边必须有空格。")])]),s._v(" "),a("p",[s._v("那么，命令"),a("code",[s._v("kubectl exec")]),s._v("能否像 docker 那样，获取一个容器的 shell 终端呢？")]),s._v(" "),a("p",[s._v("当然！和 docker 一样，我们可以通过"),a("code",[s._v("-it")]),s._v("参数以及"),a("code",[s._v("bash")]),s._v("命令来获取一个容器的 shell 交互终端。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("-i")]),s._v("：获取容器的标准输入")]),s._v(" "),a("li",[a("code",[s._v("-t")]),s._v("：获取一个伪终端")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" ac-pod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ac1 -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("获取 ac1 容器的终端之后，你就可以在 ac1 中尽情地执行命令。最后，你可以通过命令"),a("code",[s._v("exit")]),s._v("或者快捷键"),a("code",[s._v("Ctrl+D")]),s._v("来退出容器终端。")]),s._v(" "),a("p",[s._v("此外，如果不指定"),a("code",[s._v("-c")]),s._v("选项，则默认会获得第一个容器的 shell 终端，这和"),a("code",[s._v("logs")]),s._v("命令是一样的。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/05.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_5-2-2-在创建pod时执行命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-2-在创建pod时执行命令"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"5.2.2"}}),s._v("5.2.2 在创建Pod时执行命令")],1),s._v(" "),a("p",[s._v("虽然通过"),a("code",[s._v("kubectl exec")]),s._v("命令可以在现有的某个 Pod 中执行命令，但如果我想在创建 Pod 时执行命令呢？")]),s._v(" "),a("p",[s._v("和 exec 命令一样，我们可以在创建 Pod 时加上"),a("code",[s._v("--")]),s._v("符号，后面跟上想要执行的命令：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl run e-pod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" nginx --image-pull-policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("IfNotPresent -- "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello k8s"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后通过 logs 命令查看 Pod 命令行输出，可以看到所打印的字符 “Hello k8s”。")]),s._v(" "),a("p",[s._v("此外，该 Pod 的运行状态为"),a("code",[s._v("Completed")]),s._v("（完成），你可能会感到疑惑，为什么这个 Pod 的运行状态会是 Completed 呢？这个问题将会在下一章节中进行解答。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/06.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("在模拟创建 Pod 的时候，你同样可以执行命令，并将命令一同导出至 yaml 文件中：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl run e-pod2 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" nginx --image-pull-policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("IfNotPresent --dry-run"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("client "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" yaml -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello k8s"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" hello.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("打开"),a("code",[s._v("hello.yaml")]),s._v("文件之后，你将看到以下内容：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creationTimestamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token null important"}},[s._v("null")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod2\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod2\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("args")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" sh\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("c\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" echo\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" Hello k8s\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod2\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dnsPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterFirst\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restartPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Always\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("可以看到，参数"),a("code",[s._v("spec.containers.args")]),s._v("定义了一个容器在启动时将要执行的命令。")]),s._v(" "),a("p",[a("code",[s._v("args")]),s._v("看起来可能有点突兀，其实它可以使用"),a("code",[s._v("command")]),s._v("参数来代替：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creationTimestamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token null important"}},[s._v("null")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod2\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod2\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sh'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-c'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'echo \"Hello k8s\"'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod2\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dnsPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterFirst\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restartPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Always\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("换成"),a("code",[s._v("command")]),s._v("之后看得是不是更直观了点？完整的命令为"),a("code",[s._v('sh -c echo "Hello k8s"')]),s._v("，意思是通过脚本解释器 sh 来执行 echo 命令打印一个字符串。")]),s._v(" "),a("p",[s._v("然后创建该 Pod：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" hello.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("查看命令行输出，可以看到由 echo 打印出来的字符。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/07.png",alt:"Not Found Image"}}),s._v(" "),a("h3",{attrs:{id:"_5-3-pod文件的拷贝"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-pod文件的拷贝"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"5.3"}}),s._v("5.3 Pod文件的拷贝")],1),s._v(" "),a("p",[s._v("我们先通过"),a("code",[s._v("exec")]),s._v("命令在容器 ac1 中创建一个目录：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ac-pod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ac1 -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /opt/test\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/08.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_5-3-1-从物理机到容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-1-从物理机到容器"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"5.3.1"}}),s._v("5.3.1 从物理机到容器")],1),s._v(" "),a("p",[s._v("语法：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("物理机文件路径"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Pod名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("文件路径"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定容器, 不指定的话默认拷贝至第一个容器")]),s._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("物理机文件路径"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Pod名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("文件路径"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("容器名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("尝试将物理机上的"),a("code",[s._v("/etc/hosts")]),s._v("文件拷贝到 ac-pod 里的容器 ac1 的"),a("code",[s._v("/opt/test")]),s._v("目录当中：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /etc/hosts ac-pod:/opt/test\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看")]),s._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ac-pod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ac1 -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /opt/test\nkubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ac-pod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ac1 -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /opt/test/hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("拷贝成功，在容器 ac1 的对应目录中可以看到来自物理机的 hosts 文件。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/09.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("你也可以将物理机上的一个目录拷贝至容器中。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/10.png",alt:"Not Found Image"}}),s._v(" "),a("h4",{attrs:{id:"_5-3-2-从容器到物理机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-2-从容器到物理机"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"5.3.2"}}),s._v("5.3.2 从容器到物理机")],1),s._v(" "),a("p",[s._v("只需要将物理机和 Pod 的位置调换一下即可：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Pod名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("文件路径"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("物理机文件路径"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定从哪个容器中拷贝")]),s._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Pod名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("文件路径"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("物理机文件路径"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("容器名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("将容器 ac1 中的"),a("code",[s._v("/etc/passwd")]),s._v("文件拷贝至物理机的当前目录下：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" ac-pod:/etc/passwd ./passwd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("成功。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/11.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("值得一提的是，从容器中拷贝文件 到 物理机中时，你必须在物理机的路径中指定文件名。如果不指定物理机上的文件名，则拷贝会失败：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 失败, 必须在物理机路径中指定文件名")]),s._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ac1 ac-pod:/etc/passwd ./\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 成功")]),s._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" ac1 ac-pod:/etc/passwd ./abc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/12.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("但如果你拷贝的是一个文件夹，可以不指定目录名。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/13.png",alt:"Not Found Image"}}),s._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[s._v("笔记")]),s._v(" "),a("p",[s._v("使用"),a("code",[s._v("kubectl cp")]),s._v("命令从容器里拷贝文件至物理机时，必须在物理机路径中指定文件名。")])]),s._v(" "),a("h3",{attrs:{id:"_5-4-查看pod详细运行信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-查看pod详细运行信息"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"5.4"}}),s._v("5.4 查看Pod详细运行信息")],1),s._v(" "),a("p",[s._v("通过该命令可以列出某个 Pod 的详细运行信息：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl describe pods "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Pod名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可以看到这个 Pod 的名称、所处的命名空间、运行在哪个节点上。")]),s._v(" "),a("p",[s._v("还可以看到 Pod 中的容器信息，例如容器 ac1 的容器编号、镜像编号、容器运行状态等。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/14.png",alt:"Not Found Image"}}),s._v(" "),a("h3",{attrs:{id:"_5-5-为pod设置和删除标签"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-为pod设置和删除标签"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"5.5"}}),s._v("5.5 为Pod设置和删除标签")],1),s._v(" "),a("p",[s._v("在列出 Pod 的同时，我们可以添加"),a("code",[s._v("--show-labels")]),s._v("选项以显示这些 Pod 的标签，那么如何为 Pod 设置标签呢？")]),s._v(" "),a("h4",{attrs:{id:"_5-5-1-为已有的pod设置标签"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-1-为已有的pod设置标签"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"5.5.1"}}),s._v("5.5.1 为已有的Pod设置标签")],1),s._v(" "),a("p",[s._v("语法：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl label pods "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Pod名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多个标签之间使用空格分隔")]),s._v("\nkubectl label pods "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Pod名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过 减号- 来删除标签")]),s._v("\nkubectl label pods "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Pod名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("为这个 Pod 设置标签"),a("code",[s._v("status=error")]),s._v("（状态=错误），表示该 Pod 运行错误：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl label pods ac-pod "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("error\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("标签设置成功。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/22.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("同时设置多个标签：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl label pods ac-pod "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("abc")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("xyz")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("456")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("设置成功。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/23.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("注意，在生产环境中为集群资源设置标签时，标签应该具有意义，避免设置无意义标签。像此处的标签"),a("code",[s._v("abc=123")]),s._v("和"),a("code",[s._v("xyz=456")]),s._v("就是一个反面示例。")]),s._v(" "),a("h4",{attrs:{id:"_5-5-2-在创建pod时设置标签"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-2-在创建pod时设置标签"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"5.5.2"}}),s._v("5.5.2 在创建Pod时设置标签")],1),s._v(" "),a("p",[s._v("语法：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl run "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Pod名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--labels")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多个标签之间使用逗号分隔")]),s._v("\nkubectl run "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Pod名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--labels")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("值"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("创建 Pod 时通过"),a("code",[s._v("--labels")]),s._v("选项来为其设置标签。需要注意的是，在一个选项中设置多个标签时，你应该通过逗号"),a("code",[s._v(",")]),s._v("来分隔这些标签，这与"),a("code",[s._v("kubectl label pods")]),s._v("命令（通过空格分隔）不太一样。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/24.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("使用 yaml 文件创建 Pod 时，你也可以通过"),a("code",[s._v("metadata.labels")]),s._v("参数来为 Pod 设置标签。")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <Pod名称"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("<标签1>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <值1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("<标签2>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <值2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h4",{attrs:{id:"_5-5-3-删除已有的标签"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-3-删除已有的标签"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"5.5.3"}}),s._v("5.5.3 删除已有的标签")],1),s._v(" "),a("p",[s._v("很简单，同一个命令，只需要在对应的标签 “键” 后面添加减号"),a("code",[s._v("-")]),s._v("即可：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl label pods "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Pod名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("键"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 例如")]),s._v("\nkubectl label pods ac-pod abc-\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/31.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("如果你想同时删除多个标签，则用空格分隔：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl label pods ac-pod xyz- run-\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/action-pods/32.png",alt:"Not Found Image"}}),s._v(" "),a("h2",{attrs:{id:"_6-初始化pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-初始化pod"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"6"}}),s._v("6. 初始化Pod")],1),s._v(" "),a("p",[s._v("初始化 Pod 也可以叫作 Pod 中的初始化容器。")]),s._v(" "),a("h3",{attrs:{id:"_6-1-初始化容器概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-初始化容器概念"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"6.1"}}),s._v("6.1 初始化容器概念")],1),s._v(" "),a("p",[s._v("举个例子：")]),s._v(" "),a("ul",[a("li",[s._v("现在有一辆车，这辆车想过河到对岸去，但是没有桥")]),s._v(" "),a("li",[s._v("然后来了一个施工队，这个施工队在车辆过河之前，先帮忙把桥修好，然后这辆车才能过河")]),s._v(" "),a("li",[s._v("如果在施工期间发生了任何闪失，导致修桥计划终止，那这辆车就过不了河了")])]),s._v(" "),a("p",[s._v("然后，你可以这样理解初始化容器：")]),s._v(" "),a("ul",[a("li",[s._v("某个 Pod 里有一个容器，这个容器想执行某些操作，但是运行环境不满足条件")]),s._v(" "),a("li",[s._v("然后有一个初始化容器，在后续的容器启动之前，初始化容器先把环境配置好，之后的容器就可以正常启动和运行了")]),s._v(" "),a("li",[s._v("如果在初始化期间发生了任何致命错误，导致初始化容器终止，那后续的容器就都不会启动了")])]),s._v(" "),a("p",[s._v("简单来讲，初始化容器会先进行一些准备工作，为后续容器的正常运行奠定基础。")]),s._v(" "),a("h3",{attrs:{id:"_6-2-创建一个初始化容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-创建一个初始化容器"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"6.2"}}),s._v("6.2 创建一个初始化容器")],1),s._v(" "),a("p",[s._v("假设现在有一个需求，如果某个节点想要运行容器，则该节点的内核参数"),a("code",[s._v("vm.swappiness")]),s._v("必须为"),a("code",[s._v("40")]),s._v("，否则容器会运行失败。")]),s._v(" "),a("p",[s._v("通过以下命令可以查询一台主机上的"),a("code",[s._v("vm.swappiness")]),s._v("内核参数值：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/sys/vm/swappiness\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可以看到，节点 worker01 和 worker02 的内核参数"),a("code",[s._v("vm.swappiness")]),s._v("都为"),a("code",[s._v("30")]),s._v("，不满足运行条件。虽然我们可以手动修改这个参数，但这很繁琐。")]),s._v(" "),a("p",[s._v("worker01：")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/init-containers/01.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("worker02：")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/init-containers/02.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("能否在容器运行之前，先自动把当前主机的内核参数"),a("code",[s._v("vm.swappiness")]),s._v("调整为预期的值？这时候就可以用到初始化容器。")]),s._v(" "),a("p",[s._v("先通过以下命令生成一个 Pod 的 yaml 文件：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl run i-pod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" nginx --image-pull-policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("IfNotPresent --dry-run"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("client "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" init.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后我们打开这个文件，将其修改为以下内容：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creationTimestamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token null important"}},[s._v("null")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" c\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("initContainers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" alpine\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("c\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/sbin/sysctl -w vm.swappiness=40"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("securityContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("privileged")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dnsPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterFirst\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restartPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Always\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("这个 Pod 中包含两个容器，一个是位于"),a("code",[s._v("spec.containers")]),s._v("参数下的普通容器"),a("code",[s._v("c1")]),s._v("，另一个是位于"),a("code",[s._v("spec.initContainers")]),s._v("参数下的初始化容器"),a("code",[s._v("init-c")]),s._v("。容器镜像分别为 nginx 和 alpine。")]),s._v(" "),a("p",[s._v("在初始化容器"),a("code",[s._v("init-c")]),s._v("启动的时候，通过参数"),a("code",[s._v("command")]),s._v("执行命令"),a("code",[s._v("/sbin/sysctl -w vm.swappiness=40")]),s._v("，这条命令可以修改 Pod 所处物理机上的内核参数"),a("code",[s._v("vm.swappiness")]),s._v("为 40。")]),s._v(" "),a("p",[s._v("此外，由于安全策略的存在，容器不允许修改物理机的内核参数。所以这里还添加了"),a("code",[s._v("securityContext")]),s._v("选项，并通过"),a("code",[s._v("privileged: true")]),s._v("赋予了初始化容器特权权限，使其拥有足够的权限来修改物理机的内核参数。")]),s._v(" "),a("p",[s._v("创建初始化 Pod：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" init.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("查看 Pod 状态，此时容器的准备状态为"),a("code",[s._v("READY: 0/1")]),s._v("，说明容器尚未启动。而运行状态为"),a("code",[s._v("STATUS: Init:0/1")]),s._v("，说明有一个初始化容器已经启动，正处于初始化运行状态。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/init-containers/03.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("等待一段时间后，容器运行状态变为"),a("code",[s._v("Running")]),s._v("，说明初始化成功，普通容器正常启动并运行了。")]),s._v(" "),a("p",[s._v("该 Pod 运行在 worker02 节点上。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/init-containers/04.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("先看下节点 worker01 上的内核参数，还是 30 没有变化。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/init-containers/05.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("再看下 worker02 节点，由于刚刚的 Pod 在 worker02 上运行，所以初始化容器将主机上的内核参数"),a("code",[s._v("vm.swappiness")]),s._v("修改为了 40。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/init-containers/06.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("初始化容器成功配置了运行环境。")]),s._v(" "),a("h3",{attrs:{id:"_6-3-遇到错误的初始化容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-遇到错误的初始化容器"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"6.3"}}),s._v("6.3 遇到错误的初始化容器")],1),s._v(" "),a("p",[s._v("前面的例子提到过，如果在初始化期间发生了任何致命错误，导致初始化容器终止，那后续的容器就都不会启动了。我们来验证一下这个说法。")]),s._v(" "),a("p",[s._v("还是使用 6.2 中的 yaml 文件，但是我故意把"),a("code",[s._v("/sbin/sysctl")]),s._v("写错成了"),a("code",[s._v("/sbin/sysctyyl")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creationTimestamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token null important"}},[s._v("null")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod2\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod2\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" c\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("initContainers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" alpine\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("c\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/sbin/sysctyyl -w vm.swappiness=40"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("securityContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("privileged")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dnsPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterFirst\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restartPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Always\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("将以上内容保存至文件"),a("code",[s._v("init2.yaml")]),s._v("中，然后创建 Pod：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保存")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" init2.yaml")]),s._v("\n...文件内容\nEOF")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建Pod")]),s._v("\nkubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" init2.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/init-containers/07.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("然后可以看到 Pod 的运行状态为"),a("code",[s._v("Init:Error")]),s._v("，说明初始化容器遇到错误。同时由于"),a("code",[s._v("spec.restartPolicy")]),s._v("参数设置为了"),a("code",[s._v("Always")]),s._v("，所以该 Pod 会不断尝试重启，直到不再产生错误为止，但这种重启是徒劳的。")]),s._v(" "),a("p",[s._v("这验证了之前的说法，桥都没修好，车怎么过？")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/init-containers/08.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("前面提到过，一个 Pod 可以有多个容器，在"),a("code",[s._v("spec.containers")]),s._v("条目下添加参数即可。")]),s._v(" "),a("p",[s._v("那可不可以有多个初始化容器呢？当然可以，书写参数的语法和普通容器一样，只不过添加参数的位置变成了"),a("code",[s._v("spec.initContainers")]),s._v("而已：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod3\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" c\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("initContainers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" alpine\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("c1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo 123"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" alpine\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("c2\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo 456456"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" alpine\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("c3\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo 789789789"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dnsPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterFirst\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restartPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Always\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("p",[s._v("如果存在多个初始化容器，它们会如何运行？")]),s._v(" "),a("p",[s._v("例如，以上 Pod 拥有"),a("code",[s._v("init-c1")]),s._v("、"),a("code",[s._v("init-c2")]),s._v("和"),a("code",[s._v("init-c3")]),s._v("共三个初始化容器，这三个初始化容器会按定义的顺序依次执行，当这三个初始化容器都完成运行之后，普通容器"),a("code",[s._v("c")]),s._v("才会正常启动。")]),s._v(" "),a("p",[s._v("如果某一个初始化容器出现错误，则整个 Pod 都不会运行。例如，当"),a("code",[s._v("init-c1")]),s._v("完成运行之后，如果"),a("code",[s._v("init-c2")]),s._v("遇到了致命错误，则后续的初始化容器"),a("code",[s._v("init-c3")]),s._v("和普通容器"),a("code",[s._v("c")]),s._v("都将不会启动，普通容器不运行，则 Pod 也同样不会运行。")]),s._v(" "),a("h2",{attrs:{id:"_7-静态pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-静态pod"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"7"}}),s._v("7. 静态Pod")],1),s._v(" "),a("h3",{attrs:{id:"_7-1-静态pod概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-静态pod概念"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"7.1"}}),s._v("7.1 静态Pod概念")],1),s._v(" "),a("p",[s._v("在 master 节点的"),a("code",[s._v("/etc/kubernetes/manifests/")]),s._v("目录下，总是会看到以下几个 yaml 文件：")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/static-pod/01.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("这些 yaml 文件的名称是不是很眼熟？在命名空间"),a("code",[s._v("kube-system")]),s._v("中，也能看到四个同名的 Pod，它们是用于运行 master 节点的核心 Pod。")]),s._v(" "),a("p",[s._v("只有当这些 Pod 运行了，master 和其余的 node 节点才能运行和建立联系。当节点与节点之间都联系起来时，就形成了一个集群。换句话说，这四个 Pod 是用于启动集群的核心。")]),s._v(" "),a("p",[s._v("但是现在遇到了一个问题：")]),s._v(" "),a("ul",[a("li",[s._v("如果想运行 Pod，则需要依靠集群内的 master 节点来创建和调度 Pod")]),s._v(" "),a("li",[s._v("如果想启动 master 节点，又必须先运行这些核心 Pod")])]),s._v(" "),a("p",[s._v("核心 Pod 没运行，那 master 就无法运行，集群也无法运行。集群没启动，怎么创建和调度 Pod 呢？")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/static-pod/17.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("这时候就需要静态 Pod 了，这是一种不需要 master 节点即可自主运行的 Pod。")]),s._v(" "),a("p",[s._v("一般情况下，需要依靠 master 节点来创建和调度 Pod。这类 Pod 可以称其为动态 Pod（依赖 master 创建）。")]),s._v(" "),a("p",[s._v("而有些 Pod 则不需要依赖 master 节点，当 k8s 的主服务"),a("code",[s._v("kubelet")]),s._v("启动时，这些 Pod 也会跟随服务自动创建和运行。这类 Pod 可以称其为静态 Pod（不依赖 master，启动 k8s 时自动创建）。")]),s._v(" "),a("p",[s._v("什么？你问我"),a("code",[s._v("kubelet")]),s._v("是啥？请回去看 “第 1 章的 2.1 节”。")]),s._v(" "),a("h3",{attrs:{id:"_7-2-创建一个静态pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-创建一个静态pod"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"7.2"}}),s._v("7.2 创建一个静态Pod")],1),s._v(" "),a("h4",{attrs:{id:"_7-2-1-通过yaml文件创建静态pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-1-通过yaml文件创建静态pod"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"7.2.1"}}),s._v("7.2.1 通过yaml文件创建静态Pod")],1),s._v(" "),a("p",[s._v("静态 Pod 纯粹依靠 yaml 文件来创建，无法通过"),a("code",[s._v("kubectl run")]),s._v("命令来创建。")]),s._v(" "),a("p",[s._v("但你依然可以通过该命令来导出一个 yaml 文件模板：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl run static-pod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" nginx --image-pull-policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("IfNotPresent --dry-run"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("client "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" static-pod.yaml\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" static-pod.yaml /etc/kubernetes/manifests/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("通过以上命令生成一个 Pod 的 yaml 文件，然后将其拷贝到默认的静态 Pod 目录"),a("code",[s._v("/etc/kubernetes/manifests/")]),s._v("中。")]),s._v(" "),a("p",[s._v("可以看到，在拷贝 yaml 文件之前只有"),a("code",[s._v("i-pod")]),s._v("这一个 Pod，在拷贝之后，立马生成了一个新的名为"),a("code",[s._v("static-pod-<主机名>")]),s._v("的 Pod。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/static-pod/02.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("这正是由我们的 yaml 创建出来的一个静态 Pod，它的名称后面总会加上一个"),a("code",[s._v("-<主机名>")]),s._v("作为标识。")]),s._v(" "),a("h4",{attrs:{id:"_7-2-2-通过yaml文件删除静态pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-2-通过yaml文件删除静态pod"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"7.2.2"}}),s._v("7.2.2 通过yaml文件删除静态Pod")],1),s._v(" "),a("p",[s._v("静态 Pod 是无法通过命令"),a("code",[s._v("kubectl delete pods")]),s._v("来删除的，我们可以做个实验。")]),s._v(" "),a("p",[s._v("删除刚刚创建的静态 Pod：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl delete pods static-pod-www.k10.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("从图中可以看到，运行命令后提示成功删除了该 Pod。随后发现 Pod 的状态为 “Pending”，在该状态停留一会之后，Pod 的状态又变回了 “Running” 继续运行。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/static-pod/03.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("刚刚的 Pod 确实已经被删除了，但是由于 yaml 文件还存在，在删除之后的短时间内，这个 yaml 文件又被解析并创建了一个新的、一模一样的 Pod。")]),s._v(" "),a("p",[s._v("既然无法通过命令删除静态 Pod，那就直接找准源头，删除它的 yaml 文件：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" /etc/kubernetes/manifests/static-pod.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("删除源文件后，由该文件创建出来的静态 Pod 也会自动停止并删除。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/static-pod/04.png",alt:"Not Found Image"}}),s._v(" "),a("h3",{attrs:{id:"_7-3-修改静态pod存储路径"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-修改静态pod存储路径"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"7.3"}}),s._v("7.3 修改静态Pod存储路径")],1),s._v(" "),a("p",[s._v("存放静态 Pod 的默认路径为"),a("code",[s._v("/etc/kubernetes/manifests/")]),s._v("，有两种方式可以修改存放路径。")]),s._v(" "),a("h4",{attrs:{id:"_7-3-1-通过kubelet服务文件修改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-1-通过kubelet服务文件修改"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"7.3.1"}}),s._v("7.3.1 通过kubelet服务文件修改")],1),s._v(" "),a("p",[s._v("我拿 master 节点来做以下操作。")]),s._v(" "),a("ol",[a("li",[s._v("查看"),a("code",[s._v("kubelet")]),s._v("服务状态，找到服务文件的存储目录：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl status kubelet\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/static-pod/05.png",alt:"Not Found Image"}}),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("在目录下找到"),a("code",[s._v("kubelet")]),s._v("的服务文件"),a("code",[s._v("10-kubeadm.conf")]),s._v("，然后打开它：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" /usr/lib/systemd/system/kubelet.service.d/\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/static-pod/06.png",alt:"Not Found Image"}}),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[s._v("打开文件后，找到以下配置选项：")])]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# 任意一个Environment\nEnvironment="..."\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/static-pod/07.png",alt:"Not Found Image"}}),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[s._v("在该选项的最后边添加参数，修改静态 Pod 存储路径：")])]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("--pod-manifest-path=<目录>\n\n# 例如\n--pod-manifest-path=/opt/change-service\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/static-pod/08.png",alt:"Not Found Image"}}),s._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[s._v("创建对应的存储目录，然后重启"),a("code",[s._v("kubelet")]),s._v("服务：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /opt/change-service\n\nsystemctl daemon-reload\nsystemctl restart kubelet\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("重启成功后就完成了路径的修改。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/static-pod/09.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("然后你会发现，集群失灵了？服务"),a("code",[s._v("kubelet")]),s._v("的运行状态是正常的，但无论运行什么命令都毫无作用。")]),s._v(" "),a("p",[s._v("是配置错了吗？")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/static-pod/10.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("其实配置没错，反而非常对。")]),s._v(" "),a("p",[s._v("前面说过，集群的运行依靠 master 节点，master 节点的运行依靠"),a("b",[s._v("默认路径")]),a("code",[s._v("/etc/kubernetes/manifests/")]),s._v("下的核心静态 Pod。")]),s._v(" "),a("p",[s._v("由于刚刚修改了静态 Pod 的默认路径，导致 master 的核心组件无法启动，集群自然也无法运行。")]),s._v(" "),a("p",[s._v("你可以将 master 所需的静态 Pod yaml 文件拷贝到新的路径下，从而解决这个问题。"),a("b",[s._v("但一般情况下，我们都不会去修改 master 节点上的默认静态 Pod 存储目录")]),s._v("。")]),s._v(" "),a("h4",{attrs:{id:"_7-3-2-通过k8s配置文件修改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-2-通过k8s配置文件修改"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"7.3.2"}}),s._v("7.3.2 通过k8s配置文件修改")],1),s._v(" "),a("p",[s._v("既然 master 节点上有静态 Pod，那 worker 上面有没有静态 Pod 呢？——有，而且可以随意修改存储路径。")]),s._v(" "),a("ol",[a("li",[s._v("切换至 worker01 节点，打开同样的"),a("code",[s._v("kubelet")]),s._v("服务文件：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" /usr/lib/systemd/system/kubelet.service.d/\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/static-pod/11.png",alt:"Not Found Image"}}),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("打开文件后，即可看到 k8s 配置文件的存储位置。")])]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("--config=/var/lib/kubelet/config.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/static-pod/12.png",alt:"Not Found Image"}}),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[s._v("打开配置文件后，在文件最底部可以看到静态 Pod 的默认存储路径：")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("staticPodPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/kubernetes/manifests\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/static-pod/13.png",alt:"Not Found Image"}}),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[s._v("你可以通过"),a("code",[s._v("#")]),s._v("将原来的条目注释，防止原配置丢失。然后另起一行用于修改静态 Pod 存储路径：")])]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/static-pod/14.png",alt:"Not Found Image"}}),s._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[s._v("一样的创建存储目录，一样的重启"),a("code",[s._v("kubelet")]),s._v("服务：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /opt/change-conf\n\nsystemctl daemon-reload\nsystemctl restart kubelet\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("重启服务之后，在目录"),a("code",[s._v("opt/change-conf")]),s._v("下放置一个简单的 yaml 文件用于测试：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/static-pod/15.png",alt:"Not Found Image"}}),s._v(" "),a("p",[s._v("然后回到 master 节点上进行查看，发现 worker01 节点成功创建了一个名为"),a("code",[s._v("test-www.k11.com")]),s._v("的静态 Pod。")]),s._v(" "),a("img",{attrs:{src:"https://fastly.statically.io/gh/clincat/blog-imgs@main/vuepress/static/imgs/docs/cloud-native-security/kubernetes/pod/static-pod/16.png",alt:"Not Found Image"}}),s._v(" "),a("h2",{attrs:{id:"_8-小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-小结"}},[s._v("#")]),s._v(" "),a("Badge",{attrs:{type:"error",text:"8"}}),s._v("8. 小结")],1),s._v(" "),a("p",[s._v("本章对 Pod 做了一个初步的了解，通过本章的学习，你应该掌握以下技能：")]),s._v(" "),a("ul",[a("li",[s._v("使用"),a("code",[s._v("kubectl get")]),s._v("和"),a("code",[s._v("kubectl top")]),s._v("命令以及一系列参数查看 Pod")]),s._v(" "),a("li",[s._v("通过命令行或 yaml 文件的方式创建 Pod")]),s._v(" "),a("li",[s._v("通过命令行或 yaml 文件的方式删除单个/多个 Pod")]),s._v(" "),a("li",[s._v("通过"),a("code",[s._v("logs")]),s._v("、"),a("code",[s._v("exec")]),s._v("、"),a("code",[s._v("cp")]),s._v("、"),a("code",[s._v("describe")]),s._v("和"),a("code",[s._v("label")]),s._v("等子命令操作 Pod")]),s._v(" "),a("li",[s._v("创建初始化 Pod")]),s._v(" "),a("li",[s._v("修改静态 Pod 存储路径，通过 yaml 创建静态 Pod")])]),s._v(" "),a("p",[s._v("如果你已经掌握了以上内容，就试着去完成一些练习（"),a("RouterLink",{attrs:{to:"/cloud-native-security/kubernetes/practice/03/"}},[s._v("练习题-3")]),s._v("）吧！")],1)])}),[],!1,null,null,null);a.default=n.exports}}]);